document.addEventListener("DOMContentLoaded",(()=>{if(!document.location.href.includes("plausible_analytics"))return;let e={nonceElem:document.getElementById("_wpnonce"),nonce:"",showWizardElem:document.getElementById("show_wizard"),domainNameElem:document.getElementById("domain_name"),apiTokenElem:document.getElementById("api_token"),createAPITokenElems:document.getElementsByClassName("plausible-create-api-token"),buttonElems:document.getElementsByClassName("plausible-analytics-button"),stepElems:document.getElementsByClassName("plausible-analytics-wizard-next-step"),init:function(){if(""===document.location.hash&&null!==document.getElementById("plausible-analytics-wizard")&&(document.location.hash="#welcome_slide"),null!==this.nonceElem&&(this.nonce=this.nonceElem.value),this.toggleWizardStep(),window.addEventListener("hashchange",this.toggleWizardStep),null!==this.showWizardElem&&this.showWizardElem.addEventListener("click",this.showWizard),null!==this.domainNameElem&&this.domainNameElem.addEventListener("keyup",this.disableConnectButton),null!==this.apiTokenElem&&this.apiTokenElem.addEventListener("keyup",this.disableConnectButton),this.createAPITokenElems.length>0)for(let e=0;e<this.createAPITokenElems.length;e++)this.createAPITokenElems[e].addEventListener("click",this.createAPIToken);if(this.buttonElems.length>0)for(let e=0;e<this.buttonElems.length;e++)this.buttonElems[e].addEventListener("click",this.saveOption);if(document.addEventListener("click",this.toggleOption),this.stepElems.length>0)for(let e=0;e<this.stepElems.length;e++)this.stepElems[e].addEventListener("click",this.saveOptionOnNext);this.showMessages()},toggleOption:async function(t){if(null===t.target.classList||!t.target.classList.contains("plausible-analytics-toggle"))return;const n=t.target.closest("button");let s,a;s="submit"===t.target.type?n.querySelector("span"):t.target.closest("span"),n.classList.contains("bg-indigo-600")?(n.classList.replace("bg-indigo-600","bg-gray-200"),s.classList.replace("translate-x-5","translate-x-0"),n.dataset.status="off",a=""):(n.classList.replace("bg-gray-200","bg-indigo-600"),s.classList.replace("translate-x-0","translate-x-5"),n.dataset.status="on",a="on");const i=new FormData;i.append("action","plausible_analytics_toggle_option"),i.append("option_name",n.name),i.append("option_value",n.value),i.append("option_label",n.nextElementSibling.innerHTML),i.append("toggle_status",a),i.append("is_list",n.dataset.list),i.append("_nonce",e.nonce);let l=await e.ajax(i);void 0!==l.capabilities&&e.maybeDisableOptions(l.capabilities)},saveOption:function(t){const n=t.target,s=n.closest(".plausible-analytics-section").querySelectorAll("input, textarea"),a=new FormData,i=[];s.forEach((function(t){t=e.validateInput(t),i.push({name:t.name,value:t.value})})),a.append("action","plausible_analytics_save_options"),a.append("options",JSON.stringify(i)),a.append("_nonce",e.nonce),n.children.length>0&&n.children[0].classList.remove("hidden"),n.setAttribute("disabled","disabled"),e.ajax(a,n)},maybeDisableOptions:function(e){document.querySelectorAll("button[data-caps]").forEach((function(t){let n=t.dataset.caps.split(","),s=!1;n.forEach((function(t){!1===e[t]&&(s=!0)})),!0===s&&"on"===t.dataset.status&&t.dispatchEvent(new Event("click",{bubbles:!0}))}))},validateInput:function(e){return"domain_name"===e.name&&e.value.match(/^(https?:\/\/)?(www.)?/).length>0&&(e.value=e.value.replace(/^(https?:\/\/)?(www.)?/,"")),e},saveOptionOnNext:function(t){let n=document.location.hash.replace("#","");if("api_token_slide"!==n&&"domain_name_slide"!==n)return;let s=t.target.closest(".plausible-analytics-wizard-step-section").getElementsByTagName("INPUT"),a=[];for(let t of s)t=e.validateInput(t),a.push({name:t.name,value:t.value});let i=new FormData;i.append("action","plausible_analytics_save_options"),i.append("options",JSON.stringify(a)),i.append("_nonce",e.nonce),e.ajax(i).then((e=>{"api_token_slide"===n&&!0===e.success&&document.getElementById("enable_analytics_dashboard_view_stats_in_wordpress").removeAttribute("disabled")}))},disableConnectButton:function(e){let t=e.target,n=document.getElementById("connect_plausible_analytics"),s=!1;if(null===n){let e=document.location.hash;n=document.querySelector(e+" .plausible-analytics-wizard-next-step"),s=!0}null!==n&&(""===t.value?s?(n.classList+=" pointer-events-none",n.classList.replace("bg-indigo-600","bg-gray-200")):(n.disabled=!0,n.innerHTML=n.innerHTML.replace("Connected","Connect")):s?(n.classList.remove("pointer-events-none"),n.classList.replace("bg-gray-200","bg-indigo-600")):n.disabled=!1)},createAPIToken:function(e){e.preventDefault();let t=document.getElementById("domain_name").value;t=t.replaceAll("/","%2F"),window.open(`${plausible_analytics_hosted_domain}/${t}/settings/integrations?new_token=WordPress`,"_blank","location=yes,height=768,width=1024,scrollbars=yes,status=no")},showWizard:function(t){let n=new FormData;n.append("action","plausible_analytics_show_wizard"),n.append("_nonce",t.target.dataset.nonce),e.ajax(n)},toggleWizardStep:function(){if(null===document.getElementById("plausible-analytics-wizard"))return;const e=document.location.hash.substring(1).replace("_slide","");let t=document.querySelectorAll(".plausible-analytics-wizard-step"),n=document.querySelectorAll(".plausible-analytics-wizard-active-step"),s=document.querySelectorAll(".plausible-analytics-wizard-completed-step");for(let e=0;e<t.length;e++)t[e].classList.remove("hidden");for(let e=0;e<n.length;e++)n[e].classList+=" hidden";for(let e=0;e<s.length;e++)s[e].classList+=" hidden";let a=document.getElementById("active-step-"+e),i=document.getElementById("step-"+e);a.classList.remove("hidden"),i.classList+=" hidden";let l=a.dataset.completedSteps.split(",");l=l.filter((e=>e)),l.length<1||l.forEach((function(e){let t=document.getElementById("completed-step-"+e),n=document.getElementById("step-"+e);t.classList.remove("hidden"),n.classList+=" hidden"}))},ajax:function(t,n=null,s=!0){return fetch(ajaxurl,{method:"POST",body:t}).then((e=>(n&&(n.children.length>0&&(n.children[0].classList+=" hidden"),"connect_plausible_analytics"===n.id&&200===e.status?n.innerText=plausible_analytics_i18n.connected:n.removeAttribute("disabled")),(200===e.status||402===e.status)&&e.json()))).then((t=>{!0===s&&e.showMessages();let n=new CustomEvent("plausibleAjaxDone",{detail:t});return document.dispatchEvent(n),void 0!==t.data?t.data:t}))},showMessages:function(){e.fetchMessages().then((function(t){!1!==t.error?e.showMessage(t.error,"error"):!1!==t.notice?e.showMessage(t.notice,"notice"):!1!==t.success&&e.showMessage(t.success,"success"),0!==t.additional.length&&null===document.getElementById("plausible-analytics-wizard")&&(void 0!==t.additional.id&&t.additional.message?e.showAdditionalMessage(t.additional.message,t.additional.id):void 0!==t.additional.id&&""===t.additional.message&&e.removeAdditionalMessage(t.additional.id))}))},fetchMessages:function(){let t=new FormData;return t.append("action","plausible_analytics_messages"),e.ajax(t,null,!1).then((function(e){return e}))},showMessage:function(e,t="success"){"error"===t?(document.getElementById("icon-error").classList.remove("hidden"),document.getElementById("icon-success").classList.add("hidden"),document.getElementById("icon-notice").classList.add("hidden")):"notice"===t?(document.getElementById("icon-notice").classList.remove("hidden"),document.getElementById("icon-error").classList.add("hidden"),document.getElementById("icon-success").classList.add("hidden")):(document.getElementById("icon-success").classList.remove("hidden"),document.getElementById("icon-error").classList.add("hidden"),document.getElementById("icon-notice").classList.add("hidden"));let n=document.getElementById("plausible-analytics-notice");document.getElementById("plausible-analytics-notice-text").innerHTML=e,n.classList.remove("hidden"),setTimeout((function(){n.classList.replace("opacity-0","opacity-100")}),200),"error"!==t&&setTimeout((function(){n.classList.replace("opacity-100","opacity-0"),setTimeout((function(){n.classList+=" hidden"}),200)}),2e3)},showAdditionalMessage:function(e,t){let n=document.querySelector(`[name='${t}']`).closest(".plausible-analytics-group");if(n.children.length>0)for(let e=0;e<n.children.length;e++)if(n.children[e].id.includes(t))return;n.innerHTML+=e},removeAdditionalMessage:function(e){let t,n=document.querySelector(`[name="${e}"]`).closest(".plausible-analytics-group");if(n.children.length>0)for(let e=0;e<n.children.length;e++)if(n.children[e].classList.contains("plausible-analytics-hook")){t=n.children[e];break}void 0===t||t.classList.contains("plausible-analytics-persist")||n.removeChild(t)}};e.init()}));
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QyxVQUFZdUUsRUFFdkVGLEVBQU9yRixVQUFVaUMsT0FBTyxVQUV4QjBELFlBQVcsV0FDVk4sRUFBT3JGLFVBQVVRLFFBQVEsWUFBYSxjQUN2QyxHQUFHLEtBRVUsVUFBVEYsR0FDSHFGLFlBQVcsV0FDVk4sRUFBT3JGLFVBQVVRLFFBQVEsY0FBZSxhQUN4Q21GLFlBQVcsV0FDVk4sRUFBT3JGLFdBQWEsU0FDckIsR0FBRyxJQUNKLEdBQUcsSUFFTCxFQVFBd0Ysc0JBQXVCLFNBQVVJLEVBQU03RixHQUN0QyxJQUNJOEYsRUFEYS9ILFNBQVN5QyxjQUFjLFVBQVVSLE9BQ3ZCSSxRQUFRLDhCQUVuQyxHQUFJMEYsRUFBVTdELFNBQVMxQyxPQUFTLEVBQy9CLElBQUssSUFBSUMsRUFBSSxFQUFHQSxFQUFJc0csRUFBVTdELFNBQVMxQyxPQUFRQyxJQUM5QyxHQUFJc0csRUFBVTdELFNBQVN6QyxHQUFHa0YsR0FBR3ZHLFNBQVM2QixHQUVyQyxPQUtIOEYsRUFBVTdFLFdBQWE0RSxDQUN4QixFQU9BSCx3QkFBeUIsU0FBVTFGLEdBQ2xDLElBRUkrRixFQURBRCxFQURhL0gsU0FBU3lDLGNBQWMsVUFBVVIsT0FDdkJJLFFBQVEsOEJBR25DLEdBQUkwRixFQUFVN0QsU0FBUzFDLE9BQVMsRUFDL0IsSUFBSyxJQUFJQyxFQUFJLEVBQUdBLEVBQUlzRyxFQUFVN0QsU0FBUzFDLE9BQVFDLElBQzlDLEdBQUlzRyxFQUFVN0QsU0FBU3pDLEdBQUdTLFVBQVVDLFNBQVMsNEJBQTZCLENBQ3pFNkYsRUFBb0JELEVBQVU3RCxTQUFTekMsR0FFdkMsS0FDRCxNQUl3QjZCLElBQXRCMEUsR0FBb0NBLEVBQWtCOUYsVUFBVUMsU0FBUyxnQ0FDNUU0RixFQUFVRSxZQUFZRCxFQUV4QixHQUdEM0gsRUFBVVcsTUFBTSIsInNvdXJjZXMiOlsid2VicGFjazovL3BsYXVzaWJsZS1hbmFseXRpY3MvLi9hc3NldHMvc3JjL2pzL2FkbWluL21haW4uanMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBQbGF1c2libGUgQW5hbHl0aWNzXG4gKlxuICogQWRtaW4gSlNcbiAqL1xuZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsICgpID0+IHtcblx0aWYgKCFkb2N1bWVudC5sb2NhdGlvbi5ocmVmLmluY2x1ZGVzKCdwbGF1c2libGVfYW5hbHl0aWNzJykpIHtcblx0XHRyZXR1cm47XG5cdH1cblxuXHRsZXQgcGxhdXNpYmxlID0ge1xuXHRcdC8qKlxuXHRcdCAqIFByb3BlcnRpZXNcblx0XHQgKi9cblx0XHRub25jZUVsZW06IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdfd3Bub25jZScpLFxuXHRcdG5vbmNlOiAnJyxcblx0XHRzaG93V2l6YXJkRWxlbTogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Nob3dfd2l6YXJkJyksXG5cdFx0ZG9tYWluTmFtZUVsZW06IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkb21haW5fbmFtZScpLFxuXHRcdGFwaVRva2VuRWxlbTogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2FwaV90b2tlbicpLFxuXHRcdGNyZWF0ZUFQSVRva2VuRWxlbXM6IGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoJ3BsYXVzaWJsZS1jcmVhdGUtYXBpLXRva2VuJyksXG5cdFx0YnV0dG9uRWxlbXM6IGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoJ3BsYXVzaWJsZS1hbmFseXRpY3MtYnV0dG9uJyksXG5cdFx0c3RlcEVsZW1zOiBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCdwbGF1c2libGUtYW5hbHl0aWNzLXdpemFyZC1uZXh0LXN0ZXAnKSxcblxuXHRcdC8qKlxuXHRcdCAqIEJpbmQgZXZlbnRzLlxuXHRcdCAqL1xuXHRcdGluaXQ6IGZ1bmN0aW9uICgpIHtcblx0XHRcdGlmIChkb2N1bWVudC5sb2NhdGlvbi5oYXNoID09PSAnJyAmJiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGxhdXNpYmxlLWFuYWx5dGljcy13aXphcmQnKSAhPT0gbnVsbCkge1xuXHRcdFx0XHRkb2N1bWVudC5sb2NhdGlvbi5oYXNoID0gJyN3ZWxjb21lX3NsaWRlJztcblx0XHRcdH1cblxuXHRcdFx0aWYgKHRoaXMubm9uY2VFbGVtICE9PSBudWxsKSB7XG5cdFx0XHRcdHRoaXMubm9uY2UgPSB0aGlzLm5vbmNlRWxlbS52YWx1ZTtcblx0XHRcdH1cblxuXHRcdFx0dGhpcy50b2dnbGVXaXphcmRTdGVwKCk7XG5cblx0XHRcdHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdoYXNoY2hhbmdlJywgdGhpcy50b2dnbGVXaXphcmRTdGVwKTtcblxuXHRcdFx0aWYgKHRoaXMuc2hvd1dpemFyZEVsZW0gIT09IG51bGwpIHtcblx0XHRcdFx0dGhpcy5zaG93V2l6YXJkRWxlbS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMuc2hvd1dpemFyZCk7XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0aGlzLmRvbWFpbk5hbWVFbGVtICE9PSBudWxsKSB7XG5cdFx0XHRcdHRoaXMuZG9tYWluTmFtZUVsZW0uYWRkRXZlbnRMaXN0ZW5lcigna2V5dXAnLCB0aGlzLmRpc2FibGVDb25uZWN0QnV0dG9uKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKHRoaXMuYXBpVG9rZW5FbGVtICE9PSBudWxsKSB7XG5cdFx0XHRcdHRoaXMuYXBpVG9rZW5FbGVtLmFkZEV2ZW50TGlzdGVuZXIoJ2tleXVwJywgdGhpcy5kaXNhYmxlQ29ubmVjdEJ1dHRvbik7XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0aGlzLmNyZWF0ZUFQSVRva2VuRWxlbXMubGVuZ3RoID4gMCkge1xuXHRcdFx0XHRmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuY3JlYXRlQVBJVG9rZW5FbGVtcy5sZW5ndGg7IGkrKykge1xuXHRcdFx0XHRcdHRoaXMuY3JlYXRlQVBJVG9rZW5FbGVtc1tpXS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMuY3JlYXRlQVBJVG9rZW4pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0aGlzLmJ1dHRvbkVsZW1zLmxlbmd0aCA+IDApIHtcblx0XHRcdFx0Zm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmJ1dHRvbkVsZW1zLmxlbmd0aDsgaSsrKSB7XG5cdFx0XHRcdFx0dGhpcy5idXR0b25FbGVtc1tpXS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMuc2F2ZU9wdGlvbik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0LyoqXG5cdFx0XHQgKiBEdWUgdG8gdGhlIHN0cnVjdHVyZSBvZiB0aGUgdG9nZ2xlcywgYW55IGV2ZW50cyBib3VuZCB0byB0aGVtIHdvdWxkIGJlIHRyaWdnZXJlZCB0d2ljZSwgdGhhdCdzIHdoeSB3ZSBiaW5kIGl0IHRvIHRoZSBkb2N1bWVudHMnIGNsaWNrJ1xuXHRcdFx0ICogZXZlbnQuXG5cdFx0XHQgKi9cblx0XHRcdGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy50b2dnbGVPcHRpb24pO1xuXG5cdFx0XHRpZiAodGhpcy5zdGVwRWxlbXMubGVuZ3RoID4gMCkge1xuXHRcdFx0XHRmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuc3RlcEVsZW1zLmxlbmd0aDsgaSsrKSB7XG5cdFx0XHRcdFx0dGhpcy5zdGVwRWxlbXNbaV0uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzLnNhdmVPcHRpb25Pbk5leHQpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdC8qKlxuXHRcdFx0ICogUnVuIG9uY2Ugb24gcGFnZWxvYWQuXG5cdFx0XHQgKi9cblx0XHRcdHRoaXMuc2hvd01lc3NhZ2VzKCk7XG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIFRvZ2dsZSBPcHRpb24gYW5kIHN0b3JlIGluIERCLlxuXHRcdCAqXG5cdFx0ICogQHBhcmFtIGVcblx0XHQgKi9cblx0XHR0b2dnbGVPcHRpb246IGFzeW5jIGZ1bmN0aW9uIChlKSB7XG5cdFx0XHQvKipcblx0XHRcdCAqIE1ha2Ugc3VyZSBldmVudCB0YXJnZXQgaXMgYSB0b2dnbGUuXG5cdFx0XHQgKi9cblx0XHRcdGlmIChlLnRhcmdldC5jbGFzc0xpc3QgPT09IG51bGwgfHwgIWUudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygncGxhdXNpYmxlLWFuYWx5dGljcy10b2dnbGUnKSkge1xuXHRcdFx0XHRyZXR1cm47XG5cdFx0XHR9XG5cblx0XHRcdGNvbnN0IGJ1dHRvbiA9IGUudGFyZ2V0LmNsb3Nlc3QoJ2J1dHRvbicpO1xuXHRcdFx0bGV0IHRvZ2dsZTtcblxuXHRcdFx0Ly8gVGhlIGJ1dHRvbiBlbGVtZW50IGlzIGNsaWNrZWQuXG5cdFx0XHRpZiAoZS50YXJnZXQudHlwZSA9PT0gJ3N1Ym1pdCcpIHtcblx0XHRcdFx0dG9nZ2xlID0gYnV0dG9uLnF1ZXJ5U2VsZWN0b3IoJ3NwYW4nKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdC8vIFRoZSBzcGFuIGVsZW1lbnQgaXMgY2xpY2tlZC5cblx0XHRcdFx0dG9nZ2xlID0gZS50YXJnZXQuY2xvc2VzdCgnc3BhbicpO1xuXHRcdFx0fVxuXG5cdFx0XHRsZXQgdG9nZ2xlU3RhdHVzO1xuXG5cdFx0XHRpZiAoYnV0dG9uLmNsYXNzTGlzdC5jb250YWlucygnYmctaW5kaWdvLTYwMCcpKSB7XG5cdFx0XHRcdC8vIFRvZ2dsZTogb2ZmXG5cdFx0XHRcdGJ1dHRvbi5jbGFzc0xpc3QucmVwbGFjZSgnYmctaW5kaWdvLTYwMCcsICdiZy1ncmF5LTIwMCcpO1xuXHRcdFx0XHR0b2dnbGUuY2xhc3NMaXN0LnJlcGxhY2UoJ3RyYW5zbGF0ZS14LTUnLCAndHJhbnNsYXRlLXgtMCcpO1xuXHRcdFx0XHRidXR0b24uZGF0YXNldC5zdGF0dXMgPSAnb2ZmJztcblx0XHRcdFx0dG9nZ2xlU3RhdHVzID0gJyc7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQvLyBUb2dnbGU6IG9uXG5cdFx0XHRcdGJ1dHRvbi5jbGFzc0xpc3QucmVwbGFjZSgnYmctZ3JheS0yMDAnLCAnYmctaW5kaWdvLTYwMCcpO1xuXHRcdFx0XHR0b2dnbGUuY2xhc3NMaXN0LnJlcGxhY2UoJ3RyYW5zbGF0ZS14LTAnLCAndHJhbnNsYXRlLXgtNScpO1xuXHRcdFx0XHRidXR0b24uZGF0YXNldC5zdGF0dXMgPSAnb24nO1xuXHRcdFx0XHR0b2dnbGVTdGF0dXMgPSAnb24nO1xuXHRcdFx0fVxuXG5cdFx0XHRjb25zdCBmb3JtID0gbmV3IEZvcm1EYXRhKCk7XG5cdFx0XHRmb3JtLmFwcGVuZCgnYWN0aW9uJywgJ3BsYXVzaWJsZV9hbmFseXRpY3NfdG9nZ2xlX29wdGlvbicpO1xuXHRcdFx0Zm9ybS5hcHBlbmQoJ29wdGlvbl9uYW1lJywgYnV0dG9uLm5hbWUpO1xuXHRcdFx0Zm9ybS5hcHBlbmQoJ29wdGlvbl92YWx1ZScsIGJ1dHRvbi52YWx1ZSk7XG5cdFx0XHRmb3JtLmFwcGVuZCgnb3B0aW9uX2xhYmVsJywgYnV0dG9uLm5leHRFbGVtZW50U2libGluZy5pbm5lckhUTUwpO1xuXHRcdFx0Zm9ybS5hcHBlbmQoJ3RvZ2dsZV9zdGF0dXMnLCB0b2dnbGVTdGF0dXMpO1xuXHRcdFx0Zm9ybS5hcHBlbmQoJ2lzX2xpc3QnLCBidXR0b24uZGF0YXNldC5saXN0KTtcblx0XHRcdGZvcm0uYXBwZW5kKCdfbm9uY2UnLCBwbGF1c2libGUubm9uY2UpO1xuXG5cdFx0XHRsZXQgZGF0YSA9IGF3YWl0IHBsYXVzaWJsZS5hamF4KGZvcm0pO1xuXG5cdFx0XHRpZiAoZGF0YS5jYXBhYmlsaXRpZXMgPT09IHVuZGVmaW5lZCkge1xuXHRcdFx0XHRyZXR1cm47XG5cdFx0XHR9XG5cblx0XHRcdHBsYXVzaWJsZS5tYXliZURpc2FibGVPcHRpb25zKGRhdGEuY2FwYWJpbGl0aWVzKTtcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogU2F2ZSB2YWx1ZSBvZiBpbnB1dCBvciB0ZXh0IGFyZWEgdG8gREIuXG5cdFx0ICpcblx0XHQgKiBAcGFyYW0gZVxuXHRcdCAqL1xuXHRcdHNhdmVPcHRpb246IGZ1bmN0aW9uIChlKSB7XG5cdFx0XHRjb25zdCBidXR0b24gPSBlLnRhcmdldDtcblx0XHRcdGNvbnN0IHNlY3Rpb24gPSBidXR0b24uY2xvc2VzdCgnLnBsYXVzaWJsZS1hbmFseXRpY3Mtc2VjdGlvbicpO1xuXHRcdFx0Y29uc3QgaW5wdXRzID0gc2VjdGlvbi5xdWVyeVNlbGVjdG9yQWxsKCdpbnB1dCwgdGV4dGFyZWEnKTtcblx0XHRcdGNvbnN0IGZvcm0gPSBuZXcgRm9ybURhdGEoKTtcblx0XHRcdGNvbnN0IG9wdGlvbnMgPSBbXTtcblxuXHRcdFx0aW5wdXRzLmZvckVhY2goZnVuY3Rpb24gKGlucHV0KSB7XG5cdFx0XHRcdGlucHV0ID0gcGxhdXNpYmxlLnZhbGlkYXRlSW5wdXQoaW5wdXQpO1xuXG5cdFx0XHRcdG9wdGlvbnMucHVzaCh7bmFtZTogaW5wdXQubmFtZSwgdmFsdWU6IGlucHV0LnZhbHVlfSk7XG5cdFx0XHR9KTtcblxuXHRcdFx0Zm9ybS5hcHBlbmQoJ2FjdGlvbicsICdwbGF1c2libGVfYW5hbHl0aWNzX3NhdmVfb3B0aW9ucycpO1xuXHRcdFx0Zm9ybS5hcHBlbmQoJ29wdGlvbnMnLCBKU09OLnN0cmluZ2lmeShvcHRpb25zKSk7XG5cdFx0XHRmb3JtLmFwcGVuZCgnX25vbmNlJywgcGxhdXNpYmxlLm5vbmNlKTtcblxuXHRcdFx0aWYgKGJ1dHRvbi5jaGlsZHJlbi5sZW5ndGggPiAwKSB7XG5cdFx0XHRcdGJ1dHRvbi5jaGlsZHJlblswXS5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKTtcblx0XHRcdH1cblxuXHRcdFx0YnV0dG9uLnNldEF0dHJpYnV0ZSgnZGlzYWJsZWQnLCAnZGlzYWJsZWQnKTtcblxuXHRcdFx0cGxhdXNpYmxlLmFqYXgoZm9ybSwgYnV0dG9uKTtcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogRGlzYWJsZSBvcHRpb25zIGJhc2VkIG9uIHRoZSBjYXBhYmlsaXRpZXMgcmV0cmlldmVkIGZyb20gdGhlIEFQSS5cblx0XHQgKlxuXHRcdCAqIEBwYXJhbSBjYXBhYmlsaXRpZXNcblx0XHQgKi9cblx0XHRtYXliZURpc2FibGVPcHRpb25zOiBmdW5jdGlvbiAoY2FwYWJpbGl0aWVzKSB7XG5cdFx0XHRsZXQgb3B0aW9ucyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ2J1dHRvbltkYXRhLWNhcHNdJyk7XG5cblx0XHRcdG9wdGlvbnMuZm9yRWFjaChmdW5jdGlvbiAob3B0aW9uKSB7XG5cdFx0XHRcdGxldCBjYXBzID0gb3B0aW9uLmRhdGFzZXQuY2Fwcy5zcGxpdCgnLCcpO1xuXHRcdFx0XHRsZXQgZGlzYWJsZSA9IGZhbHNlO1xuXG5cdFx0XHRcdGNhcHMuZm9yRWFjaChmdW5jdGlvbiAoY2FwKSB7XG5cdFx0XHRcdFx0aWYgKGNhcGFiaWxpdGllc1tjYXBdID09PSBmYWxzZSkge1xuXHRcdFx0XHRcdFx0ZGlzYWJsZSA9IHRydWU7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9KTtcblxuXHRcdFx0XHRpZiAoZGlzYWJsZSA9PT0gdHJ1ZSkge1xuXHRcdFx0XHRcdC8vIFRyaWdnZXIgYSBjbGljayB0byBtYWtlIHN1cmUgdGhlIG9wdGlvbiBpcyBkaXNhYmxlZC5cblx0XHRcdFx0XHRpZiAob3B0aW9uLmRhdGFzZXQuc3RhdHVzID09PSAnb24nKSB7XG5cdFx0XHRcdFx0XHRvcHRpb24uZGlzcGF0Y2hFdmVudChuZXcgRXZlbnQoJ2NsaWNrJywge2J1YmJsZXM6IHRydWV9KSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogQ3VycmVudGx5IG9ubHkgdmFsaWRhdGVzIHRoZSBkb21haW5fbmFtZSBpbnB1dCwgYnV0IGNhbiBiZSB1c2VkIGluIHRoZSBmdXR1cmUgZm9yIG90aGVyIGN1c3RvbSBpbnB1dCB2YWxpZGF0aW9ucy5cblx0XHQgKlxuXHRcdCAqIEBwYXJhbSBpbnB1dFxuXHRcdCAqIEByZXR1cm5zIHsqfVxuXHRcdCAqL1xuXHRcdHZhbGlkYXRlSW5wdXQ6IGZ1bmN0aW9uIChpbnB1dCkge1xuXHRcdFx0Ly8gU3RyaXAgaHR0cChzKTovLyh3d3cuKSBmcm9tIGRvbWFpbl9uYW1lIGJlZm9yZSBzZW5kaW5nIGl0LlxuXHRcdFx0aWYgKGlucHV0Lm5hbWUgPT09ICdkb21haW5fbmFtZScgJiYgaW5wdXQudmFsdWUubWF0Y2goL14oaHR0cHM/OlxcL1xcLyk/KHd3dy4pPy8pLmxlbmd0aCA+IDApIHtcblx0XHRcdFx0aW5wdXQudmFsdWUgPSBpbnB1dC52YWx1ZS5yZXBsYWNlKC9eKGh0dHBzPzpcXC9cXC8pPyh3d3cuKT8vLCAnJyk7XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBpbnB1dDtcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogU2F2ZSBPcHRpb25zIG9uIE5leHQgY2xpY2sgZm9yIEFQSSBUb2tlbiBhbmQgRG9tYWluIE5hbWUgc2xpZGVzLlxuXHRcdCAqXG5cdFx0ICogQHBhcmFtIGVcblx0XHQgKi9cblx0XHRzYXZlT3B0aW9uT25OZXh0OiBmdW5jdGlvbiAoZSkge1xuXHRcdFx0bGV0IGhhc2ggPSBkb2N1bWVudC5sb2NhdGlvbi5oYXNoLnJlcGxhY2UoJyMnLCAnJyk7XG5cblx0XHRcdGlmIChoYXNoICE9PSAnYXBpX3Rva2VuX3NsaWRlJyAmJiBoYXNoICE9PSAnZG9tYWluX25hbWVfc2xpZGUnKSB7XG5cdFx0XHRcdHJldHVybjtcblx0XHRcdH1cblxuXHRcdFx0bGV0IGZvcm0gPSBlLnRhcmdldC5jbG9zZXN0KCcucGxhdXNpYmxlLWFuYWx5dGljcy13aXphcmQtc3RlcC1zZWN0aW9uJyk7XG5cdFx0XHRsZXQgaW5wdXRzID0gZm9ybS5nZXRFbGVtZW50c0J5VGFnTmFtZSgnSU5QVVQnKTtcblx0XHRcdGxldCBvcHRpb25zID0gW107XG5cblx0XHRcdGZvciAobGV0IGlucHV0IG9mIGlucHV0cykge1xuXHRcdFx0XHRpbnB1dCA9IHBsYXVzaWJsZS52YWxpZGF0ZUlucHV0KGlucHV0KTtcblxuXHRcdFx0XHRvcHRpb25zLnB1c2goe25hbWU6IGlucHV0Lm5hbWUsIHZhbHVlOiBpbnB1dC52YWx1ZX0pO1xuXHRcdFx0fVxuXG5cdFx0XHRsZXQgZGF0YSA9IG5ldyBGb3JtRGF0YSgpO1xuXG5cdFx0XHRkYXRhLmFwcGVuZCgnYWN0aW9uJywgJ3BsYXVzaWJsZV9hbmFseXRpY3Nfc2F2ZV9vcHRpb25zJyk7XG5cdFx0XHRkYXRhLmFwcGVuZCgnb3B0aW9ucycsIEpTT04uc3RyaW5naWZ5KG9wdGlvbnMpKTtcblx0XHRcdGRhdGEuYXBwZW5kKCdfbm9uY2UnLCBwbGF1c2libGUubm9uY2UpO1xuXG5cdFx0XHRwbGF1c2libGUuYWpheChkYXRhKS50aGVuKHJlc3BvbnNlID0+IHtcblx0XHRcdFx0LyoqXG5cdFx0XHRcdCAqIERpc2FibGUgVmlldyBTdGF0cyBidXR0b24sIGlmIEFQSSB0b2tlbiBpcyBlbnRlcmVkIGFuZCB2YWxpZC5cblx0XHRcdFx0ICovXG5cdFx0XHRcdGlmIChoYXNoID09PSAnYXBpX3Rva2VuX3NsaWRlJyAmJiByZXNwb25zZS5zdWNjZXNzID09PSB0cnVlKSB7XG5cdFx0XHRcdFx0bGV0IHN0YXRzX2J1dHRvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdlbmFibGVfYW5hbHl0aWNzX2Rhc2hib2FyZF92aWV3X3N0YXRzX2luX3dvcmRwcmVzcycpO1xuXG5cdFx0XHRcdFx0c3RhdHNfYnV0dG9uLnJlbW92ZUF0dHJpYnV0ZSgnZGlzYWJsZWQnKTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIERpc2FibGUgQ29ubmVjdCBidXR0b24gaWYgRG9tYWluIE5hbWUgb3IgQVBJIFRva2VuIGZpZWxkIGlzIGVtcHR5LlxuXHRcdCAqXG5cdFx0ICogQHBhcmFtIGVcblx0XHQgKi9cblx0XHRkaXNhYmxlQ29ubmVjdEJ1dHRvbjogZnVuY3Rpb24gKGUpIHtcblx0XHRcdGxldCB0YXJnZXQgPSBlLnRhcmdldDtcblx0XHRcdGxldCBidXR0b24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY29ubmVjdF9wbGF1c2libGVfYW5hbHl0aWNzJyk7XG5cdFx0XHRsZXQgYnV0dG9uSXNIcmVmID0gZmFsc2U7XG5cblx0XHRcdGlmIChidXR0b24gPT09IG51bGwpIHtcblx0XHRcdFx0bGV0IHNsaWRlX2lkID0gZG9jdW1lbnQubG9jYXRpb24uaGFzaDtcblx0XHRcdFx0YnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihzbGlkZV9pZCArICcgLnBsYXVzaWJsZS1hbmFseXRpY3Mtd2l6YXJkLW5leHQtc3RlcCcpO1xuXHRcdFx0XHRidXR0b25Jc0hyZWYgPSB0cnVlO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYnV0dG9uID09PSBudWxsKSB7XG5cdFx0XHRcdHJldHVybjtcblx0XHRcdH1cblxuXHRcdFx0aWYgKHRhcmdldC52YWx1ZSAhPT0gJycpIHtcblx0XHRcdFx0aWYgKCFidXR0b25Jc0hyZWYpIHtcblx0XHRcdFx0XHRidXR0b24uZGlzYWJsZWQgPSBmYWxzZTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRidXR0b24uY2xhc3NMaXN0LnJlbW92ZSgncG9pbnRlci1ldmVudHMtbm9uZScpO1xuXHRcdFx0XHRcdGJ1dHRvbi5jbGFzc0xpc3QucmVwbGFjZSgnYmctZ3JheS0yMDAnLCAnYmctaW5kaWdvLTYwMCcpXG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm47XG5cdFx0XHR9XG5cblx0XHRcdGlmICghYnV0dG9uSXNIcmVmKSB7XG5cdFx0XHRcdGJ1dHRvbi5kaXNhYmxlZCA9IHRydWU7XG5cdFx0XHRcdGJ1dHRvbi5pbm5lckhUTUwgPSBidXR0b24uaW5uZXJIVE1MLnJlcGxhY2UoJ0Nvbm5lY3RlZCcsICdDb25uZWN0Jyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRidXR0b24uY2xhc3NMaXN0ICs9ICcgcG9pbnRlci1ldmVudHMtbm9uZSc7XG5cdFx0XHRcdGJ1dHRvbi5jbGFzc0xpc3QucmVwbGFjZSgnYmctaW5kaWdvLTYwMCcsICdiZy1ncmF5LTIwMCcpXG5cdFx0XHR9XG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIE9wZW4gY3JlYXRlIEFQSSB0b2tlbiBkaWFsb2cuXG5cdFx0ICpcblx0XHQgKiBAcGFyYW0gZVxuXHRcdCAqL1xuXHRcdGNyZWF0ZUFQSVRva2VuOiBmdW5jdGlvbiAoZSkge1xuXHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXG5cdFx0XHRsZXQgZG9tYWluID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RvbWFpbl9uYW1lJykudmFsdWU7XG5cdFx0XHRkb21haW4gPSBkb21haW4ucmVwbGFjZUFsbCgnLycsICclMkYnKTtcblxuXHRcdFx0d2luZG93Lm9wZW4oYCR7cGxhdXNpYmxlX2FuYWx5dGljc19ob3N0ZWRfZG9tYWlufS8ke2RvbWFpbn0vc2V0dGluZ3MvaW50ZWdyYXRpb25zP25ld190b2tlbj1Xb3JkUHJlc3NgLCAnX2JsYW5rJywgJ2xvY2F0aW9uPXllcyxoZWlnaHQ9NzY4LHdpZHRoPTEwMjQsc2Nyb2xsYmFycz15ZXMsc3RhdHVzPW5vJyk7XG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIFNob3cgd2l6YXJkLlxuXHRcdCAqXG5cdFx0ICogQHBhcmFtIGVcblx0XHQgKi9cblx0XHRzaG93V2l6YXJkOiBmdW5jdGlvbiAoZSkge1xuXHRcdFx0bGV0IGRhdGEgPSBuZXcgRm9ybURhdGEoKTtcblx0XHRcdGRhdGEuYXBwZW5kKCdhY3Rpb24nLCAncGxhdXNpYmxlX2FuYWx5dGljc19zaG93X3dpemFyZCcpO1xuXHRcdFx0ZGF0YS5hcHBlbmQoJ19ub25jZScsIGUudGFyZ2V0LmRhdGFzZXQubm9uY2UpO1xuXG5cdFx0XHRwbGF1c2libGUuYWpheChkYXRhKTtcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogVG9nZ2xlcyB0aGUgYWN0aXZlL2luYWN0aXZlL2N1cnJlbnQgc3RhdGUgb2YgdGhlIHN0ZXBzLlxuXHRcdCAqL1xuXHRcdHRvZ2dsZVdpemFyZFN0ZXA6IGZ1bmN0aW9uICgpIHtcblx0XHRcdGlmIChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGxhdXNpYmxlLWFuYWx5dGljcy13aXphcmQnKSA9PT0gbnVsbCkge1xuXHRcdFx0XHRyZXR1cm47XG5cdFx0XHR9XG5cblx0XHRcdGNvbnN0IGhhc2ggPSBkb2N1bWVudC5sb2NhdGlvbi5oYXNoLnN1YnN0cmluZygxKS5yZXBsYWNlKCdfc2xpZGUnLCAnJyk7XG5cblx0XHRcdC8qKlxuXHRcdFx0ICogUmVzZXQgYWxsIHN0ZXBzIHRvIGluYWN0aXZlLlxuXHRcdFx0ICovXG5cdFx0XHRsZXQgYWxsU3RlcHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcucGxhdXNpYmxlLWFuYWx5dGljcy13aXphcmQtc3RlcCcpO1xuXHRcdFx0bGV0IGFjdGl2ZVN0ZXBzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnBsYXVzaWJsZS1hbmFseXRpY3Mtd2l6YXJkLWFjdGl2ZS1zdGVwJyk7XG5cdFx0XHRsZXQgY29tcGxldGVkU3RlcHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcucGxhdXNpYmxlLWFuYWx5dGljcy13aXphcmQtY29tcGxldGVkLXN0ZXAnKTtcblxuXHRcdFx0Zm9yIChsZXQgaSA9IDA7IGkgPCBhbGxTdGVwcy5sZW5ndGg7IGkrKykge1xuXHRcdFx0XHRhbGxTdGVwc1tpXS5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKTtcblx0XHRcdH1cblxuXHRcdFx0Zm9yIChsZXQgaSA9IDA7IGkgPCBhY3RpdmVTdGVwcy5sZW5ndGg7IGkrKykge1xuXHRcdFx0XHRhY3RpdmVTdGVwc1tpXS5jbGFzc0xpc3QgKz0gJyBoaWRkZW4nO1xuXHRcdFx0fVxuXG5cdFx0XHRmb3IgKGxldCBpID0gMDsgaSA8IGNvbXBsZXRlZFN0ZXBzLmxlbmd0aDsgaSsrKSB7XG5cdFx0XHRcdGNvbXBsZXRlZFN0ZXBzW2ldLmNsYXNzTGlzdCArPSAnIGhpZGRlbic7XG5cdFx0XHR9XG5cblx0XHRcdC8qKlxuXHRcdFx0ICogTWFyayBjdXJyZW50IHN0ZXAgYXMgYWN0aXZlLlxuXHRcdFx0ICovXG5cdFx0XHRsZXQgY3VycmVudFN0ZXAgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYWN0aXZlLXN0ZXAtJyArIGhhc2gpO1xuXHRcdFx0bGV0IGluYWN0aXZlQ3VycmVudFN0ZXAgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3RlcC0nICsgaGFzaCk7XG5cblx0XHRcdGN1cnJlbnRTdGVwLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpO1xuXHRcdFx0aW5hY3RpdmVDdXJyZW50U3RlcC5jbGFzc0xpc3QgKz0gJyBoaWRkZW4nO1xuXG5cdFx0XHQvKipcblx0XHRcdCAqIE1hcmsgc3RlcHMgYXMgY29tcGxldGVkLlxuXHRcdFx0ICpcblx0XHRcdCAqIEB0eXBlIHtzdHJpbmdbXX1cblx0XHRcdCAqL1xuXHRcdFx0bGV0IGN1cnJlbnRseUNvbXBsZXRlZFN0ZXBzID0gY3VycmVudFN0ZXAuZGF0YXNldC5jb21wbGV0ZWRTdGVwcy5zcGxpdCgnLCcpO1xuXG5cdFx0XHQvKipcblx0XHRcdCAqIEZpbHRlciBlbXB0eSBhcnJheSBlbGVtZW50cy5cblx0XHRcdCAqIEB0eXBlIHtzdHJpbmdbXX1cblx0XHRcdCAqL1xuXHRcdFx0Y3VycmVudGx5Q29tcGxldGVkU3RlcHMgPSBjdXJyZW50bHlDb21wbGV0ZWRTdGVwcy5maWx0ZXIobiA9PiBuKTtcblxuXHRcdFx0aWYgKGN1cnJlbnRseUNvbXBsZXRlZFN0ZXBzLmxlbmd0aCA8IDEpIHtcblx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0fVxuXG5cdFx0XHRjdXJyZW50bHlDb21wbGV0ZWRTdGVwcy5mb3JFYWNoKGZ1bmN0aW9uIChzdGVwKSB7XG5cdFx0XHRcdGxldCBjb21wbGV0ZWRTdGVwID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbXBsZXRlZC1zdGVwLScgKyBzdGVwKTtcblx0XHRcdFx0bGV0IGluYWN0aXZlU3RlcCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzdGVwLScgKyBzdGVwKTtcblxuXHRcdFx0XHRjb21wbGV0ZWRTdGVwLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpO1xuXHRcdFx0XHRpbmFjdGl2ZVN0ZXAuY2xhc3NMaXN0ICs9ICcgaGlkZGVuJztcblx0XHRcdH0pO1xuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBEbyBBSkFYIHJlcXVlc3QuXG5cdFx0ICpcblx0XHQgKiBAcGFyYW0gZGF0YVxuXHRcdCAqIEBwYXJhbSBidXR0b25cblx0XHQgKiBAcGFyYW0gc2hvd01lc3NhZ2VzXG5cdFx0ICpcblx0XHQgKiBAcmV0dXJuIG9iamVjdFxuXHRcdCAqL1xuXHRcdGFqYXg6IGZ1bmN0aW9uIChkYXRhLCBidXR0b24gPSBudWxsLCBzaG93TWVzc2FnZXMgPSB0cnVlKSB7XG5cdFx0XHRyZXR1cm4gZmV0Y2goXG5cdFx0XHRcdGFqYXh1cmwsXG5cdFx0XHRcdHtcblx0XHRcdFx0XHRtZXRob2Q6ICdQT1NUJyxcblx0XHRcdFx0XHRib2R5OiBkYXRhLFxuXHRcdFx0XHR9XG5cdFx0XHQpLnRoZW4ocmVzcG9uc2UgPT4ge1xuXHRcdFx0XHRpZiAoYnV0dG9uKSB7XG5cdFx0XHRcdFx0aWYgKGJ1dHRvbi5jaGlsZHJlbi5sZW5ndGggPiAwKSB7XG5cdFx0XHRcdFx0XHRidXR0b24uY2hpbGRyZW5bMF0uY2xhc3NMaXN0ICs9ICcgaGlkZGVuJztcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAoYnV0dG9uLmlkID09PSAnY29ubmVjdF9wbGF1c2libGVfYW5hbHl0aWNzJyAmJiByZXNwb25zZS5zdGF0dXMgPT09IDIwMCkge1xuXHRcdFx0XHRcdFx0YnV0dG9uLmlubmVyVGV4dCA9IHBsYXVzaWJsZV9hbmFseXRpY3NfaTE4bi5jb25uZWN0ZWQ7XG5cdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdGJ1dHRvbi5yZW1vdmVBdHRyaWJ1dGUoJ2Rpc2FibGVkJyk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cblx0XHRcdFx0Ly8gV2Ugc3RpbGwgd2FudCB0aGUgZGF0YSwgaWYgaXQncyBhIFBheW1lbnQgUmVxdWlyZWQgZXJyb3IuXG5cdFx0XHRcdGlmIChyZXNwb25zZS5zdGF0dXMgPT09IDIwMCB8fCByZXNwb25zZS5zdGF0dXMgPT09IDQwMikge1xuXHRcdFx0XHRcdHJldHVybiByZXNwb25zZS5qc29uKCk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0XHR9KS50aGVuKHJlc3BvbnNlID0+IHtcblx0XHRcdFx0aWYgKHNob3dNZXNzYWdlcyA9PT0gdHJ1ZSkge1xuXHRcdFx0XHRcdHBsYXVzaWJsZS5zaG93TWVzc2FnZXMoKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGxldCBldmVudCA9IG5ldyBDdXN0b21FdmVudCgncGxhdXNpYmxlQWpheERvbmUnLCB7ZGV0YWlsOiByZXNwb25zZX0pO1xuXG5cdFx0XHRcdGRvY3VtZW50LmRpc3BhdGNoRXZlbnQoZXZlbnQpO1xuXG5cdFx0XHRcdGlmIChyZXNwb25zZS5kYXRhICE9PSB1bmRlZmluZWQpIHtcblx0XHRcdFx0XHRyZXR1cm4gcmVzcG9uc2UuZGF0YTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRyZXR1cm4gcmVzcG9uc2U7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBTaG93IG1lc3NhZ2VzIG9uIHNjcmVlbi5cblx0XHQgKi9cblx0XHRzaG93TWVzc2FnZXM6IGZ1bmN0aW9uICgpIHtcblx0XHRcdGxldCBtZXNzYWdlcyA9IHBsYXVzaWJsZS5mZXRjaE1lc3NhZ2VzKCk7XG5cblx0XHRcdG1lc3NhZ2VzLnRoZW4oZnVuY3Rpb24gKG1lc3NhZ2VzKSB7XG5cdFx0XHRcdGlmIChtZXNzYWdlcy5lcnJvciAhPT0gZmFsc2UpIHtcblx0XHRcdFx0XHRwbGF1c2libGUuc2hvd01lc3NhZ2UobWVzc2FnZXMuZXJyb3IsICdlcnJvcicpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKG1lc3NhZ2VzLm5vdGljZSAhPT0gZmFsc2UpIHtcblx0XHRcdFx0XHRwbGF1c2libGUuc2hvd01lc3NhZ2UobWVzc2FnZXMubm90aWNlLCAnbm90aWNlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAobWVzc2FnZXMuc3VjY2VzcyAhPT0gZmFsc2UpIHtcblx0XHRcdFx0XHRwbGF1c2libGUuc2hvd01lc3NhZ2UobWVzc2FnZXMuc3VjY2VzcywgJ3N1Y2Nlc3MnKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmIChtZXNzYWdlcy5hZGRpdGlvbmFsLmxlbmd0aCA9PT0gMCB8fCBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGxhdXNpYmxlLWFuYWx5dGljcy13aXphcmQnKSAhPT0gbnVsbCkge1xuXHRcdFx0XHRcdHJldHVybjtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmIChtZXNzYWdlcy5hZGRpdGlvbmFsLmlkICE9PSB1bmRlZmluZWQgJiYgbWVzc2FnZXMuYWRkaXRpb25hbC5tZXNzYWdlKSB7XG5cdFx0XHRcdFx0cGxhdXNpYmxlLnNob3dBZGRpdGlvbmFsTWVzc2FnZShtZXNzYWdlcy5hZGRpdGlvbmFsLm1lc3NhZ2UsIG1lc3NhZ2VzLmFkZGl0aW9uYWwuaWQpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKG1lc3NhZ2VzLmFkZGl0aW9uYWwuaWQgIT09IHVuZGVmaW5lZCAmJiBtZXNzYWdlcy5hZGRpdGlvbmFsLm1lc3NhZ2UgPT09ICcnKSB7XG5cdFx0XHRcdFx0cGxhdXNpYmxlLnJlbW92ZUFkZGl0aW9uYWxNZXNzYWdlKG1lc3NhZ2VzLmFkZGl0aW9uYWwuaWQpO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogRmV0Y2ggdGhlIG1lc3NhZ2VzIGZvciBkaXNwbGF5LlxuXHRcdCAqL1xuXHRcdGZldGNoTWVzc2FnZXM6IGZ1bmN0aW9uICgpIHtcblx0XHRcdGxldCBkYXRhID0gbmV3IEZvcm1EYXRhKCk7XG5cdFx0XHRkYXRhLmFwcGVuZCgnYWN0aW9uJywgJ3BsYXVzaWJsZV9hbmFseXRpY3NfbWVzc2FnZXMnKTtcblxuXHRcdFx0bGV0IHJlc3VsdCA9IHBsYXVzaWJsZS5hamF4KGRhdGEsIG51bGwsIGZhbHNlKTtcblxuXHRcdFx0cmV0dXJuIHJlc3VsdC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xuXHRcdFx0XHRyZXR1cm4gcmVzcG9uc2U7XG5cdFx0XHR9KTtcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogRGlzcGxheXMgYSBub3RpY2Ugb3IgZXJyb3IgbWVzc2FnZS5cblx0XHQgKlxuXHRcdCAqIEBwYXJhbSBtZXNzYWdlXG5cdFx0ICogQHBhcmFtIHR5cGUgZXJyb3J8d2FybmluZ3xzdWNjZXNzIERlZmF1bHRzIHRvIHN1Y2Nlc3MuXG5cdFx0ICovXG5cdFx0c2hvd01lc3NhZ2U6IGZ1bmN0aW9uIChtZXNzYWdlLCB0eXBlID0gJ3N1Y2Nlc3MnKSB7XG5cdFx0XHRpZiAodHlwZSA9PT0gJ2Vycm9yJykge1xuXHRcdFx0XHRkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaWNvbi1lcnJvcicpLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpO1xuXHRcdFx0XHRkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaWNvbi1zdWNjZXNzJykuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7XG5cdFx0XHRcdGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpY29uLW5vdGljZScpLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlID09PSAnbm90aWNlJykge1xuXHRcdFx0XHRkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaWNvbi1ub3RpY2UnKS5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKTtcblx0XHRcdFx0ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ljb24tZXJyb3InKS5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTtcblx0XHRcdFx0ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ljb24tc3VjY2VzcycpLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ljb24tc3VjY2VzcycpLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpO1xuXHRcdFx0XHRkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaWNvbi1lcnJvcicpLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpO1xuXHRcdFx0XHRkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaWNvbi1ub3RpY2UnKS5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTtcblx0XHRcdH1cblxuXHRcdFx0bGV0IG5vdGljZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwbGF1c2libGUtYW5hbHl0aWNzLW5vdGljZScpO1xuXG5cdFx0XHRkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGxhdXNpYmxlLWFuYWx5dGljcy1ub3RpY2UtdGV4dCcpLmlubmVySFRNTCA9IG1lc3NhZ2U7XG5cblx0XHRcdG5vdGljZS5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKTtcblxuXHRcdFx0c2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG5cdFx0XHRcdG5vdGljZS5jbGFzc0xpc3QucmVwbGFjZSgnb3BhY2l0eS0wJywgJ29wYWNpdHktMTAwJyk7XG5cdFx0XHR9LCAyMDApXG5cblx0XHRcdGlmICh0eXBlICE9PSAnZXJyb3InKSB7XG5cdFx0XHRcdHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuXHRcdFx0XHRcdG5vdGljZS5jbGFzc0xpc3QucmVwbGFjZSgnb3BhY2l0eS0xMDAnLCAnb3BhY2l0eS0wJyk7XG5cdFx0XHRcdFx0c2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG5cdFx0XHRcdFx0XHRub3RpY2UuY2xhc3NMaXN0ICs9ICcgaGlkZGVuJztcblx0XHRcdFx0XHR9LCAyMDApXG5cdFx0XHRcdH0sIDIwMDApO1xuXHRcdFx0fVxuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBSZW5kZXJzIGEgSFRNTCBib3ggY29udGFpbmluZyBhZGRpdGlvbmFsIGluZm9ybWF0aW9uIGFib3V0IHRoZSBlbmFibGVkIG9wdGlvbi5cblx0XHQgKlxuXHRcdCAqIEBwYXJhbSBodG1sXG5cdFx0ICogQHBhcmFtIHRhcmdldFxuXHRcdCAqL1xuXHRcdHNob3dBZGRpdGlvbmFsTWVzc2FnZTogZnVuY3Rpb24gKGh0bWwsIHRhcmdldCkge1xuXHRcdFx0bGV0IHRhcmdldEVsZW0gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBbbmFtZT0nJHt0YXJnZXR9J11gKTtcblx0XHRcdGxldCBjb250YWluZXIgPSB0YXJnZXRFbGVtLmNsb3Nlc3QoJy5wbGF1c2libGUtYW5hbHl0aWNzLWdyb3VwJyk7XG5cblx0XHRcdGlmIChjb250YWluZXIuY2hpbGRyZW4ubGVuZ3RoID4gMCkge1xuXHRcdFx0XHRmb3IgKGxldCBpID0gMDsgaSA8IGNvbnRhaW5lci5jaGlsZHJlbi5sZW5ndGg7IGkrKykge1xuXHRcdFx0XHRcdGlmIChjb250YWluZXIuY2hpbGRyZW5baV0uaWQuaW5jbHVkZXModGFyZ2V0KSkge1xuXHRcdFx0XHRcdFx0Ly8gVGhpcyBtZXNzYWdlIGFscmVhZHkgZXhpc3RzLlxuXHRcdFx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRjb250YWluZXIuaW5uZXJIVE1MICs9IGh0bWw7XG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIFJlbW92ZXMgdGhlIGFkZGl0aW9uYWwgaW5mb3JtYXRpb24gYm94IHdoZW4gdGhlIG9wdGlvbiBpcyBkaXNhYmxlZC5cblx0XHQgKlxuXHRcdCAqIEBwYXJhbSB0YXJnZXRcblx0XHQgKi9cblx0XHRyZW1vdmVBZGRpdGlvbmFsTWVzc2FnZTogZnVuY3Rpb24gKHRhcmdldCkge1xuXHRcdFx0bGV0IHRhcmdldEVsZW0gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBbbmFtZT1cIiR7dGFyZ2V0fVwiXWApO1xuXHRcdFx0bGV0IGNvbnRhaW5lciA9IHRhcmdldEVsZW0uY2xvc2VzdCgnLnBsYXVzaWJsZS1hbmFseXRpY3MtZ3JvdXAnKTtcblx0XHRcdGxldCBhZGRpdGlvbmFsTWVzc2FnZTtcblxuXHRcdFx0aWYgKGNvbnRhaW5lci5jaGlsZHJlbi5sZW5ndGggPiAwKSB7XG5cdFx0XHRcdGZvciAobGV0IGkgPSAwOyBpIDwgY29udGFpbmVyLmNoaWxkcmVuLmxlbmd0aDsgaSsrKSB7XG5cdFx0XHRcdFx0aWYgKGNvbnRhaW5lci5jaGlsZHJlbltpXS5jbGFzc0xpc3QuY29udGFpbnMoJ3BsYXVzaWJsZS1hbmFseXRpY3MtaG9vaycpKSB7XG5cdFx0XHRcdFx0XHRhZGRpdGlvbmFsTWVzc2FnZSA9IGNvbnRhaW5lci5jaGlsZHJlbltpXTtcblxuXHRcdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhZGRpdGlvbmFsTWVzc2FnZSAhPT0gdW5kZWZpbmVkICYmICFhZGRpdGlvbmFsTWVzc2FnZS5jbGFzc0xpc3QuY29udGFpbnMoJ3BsYXVzaWJsZS1hbmFseXRpY3MtcGVyc2lzdCcpKSB7XG5cdFx0XHRcdGNvbnRhaW5lci5yZW1vdmVDaGlsZChhZGRpdGlvbmFsTWVzc2FnZSk7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0cGxhdXNpYmxlLmluaXQoKTtcbn0pO1xuIl0sIm5hbWVzIjpbImRvY3VtZW50IiwiYWRkRXZlbnRMaXN0ZW5lciIsImxvY2F0aW9uIiwiaHJlZiIsImluY2x1ZGVzIiwicGxhdXNpYmxlIiwibm9uY2VFbGVtIiwiZ2V0RWxlbWVudEJ5SWQiLCJub25jZSIsInNob3dXaXphcmRFbGVtIiwiZG9tYWluTmFtZUVsZW0iLCJhcGlUb2tlbkVsZW0iLCJjcmVhdGVBUElUb2tlbkVsZW1zIiwiZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSIsImJ1dHRvbkVsZW1zIiwic3RlcEVsZW1zIiwiaW5pdCIsImhhc2giLCJ0aGlzIiwidmFsdWUiLCJ0b2dnbGVXaXphcmRTdGVwIiwid2luZG93Iiwic2hvd1dpemFyZCIsImRpc2FibGVDb25uZWN0QnV0dG9uIiwibGVuZ3RoIiwiaSIsImNyZWF0ZUFQSVRva2VuIiwic2F2ZU9wdGlvbiIsInRvZ2dsZU9wdGlvbiIsInNhdmVPcHRpb25Pbk5leHQiLCJzaG93TWVzc2FnZXMiLCJhc3luYyIsImUiLCJ0YXJnZXQiLCJjbGFzc0xpc3QiLCJjb250YWlucyIsImJ1dHRvbiIsImNsb3Nlc3QiLCJ0b2dnbGUiLCJ0b2dnbGVTdGF0dXMiLCJ0eXBlIiwicXVlcnlTZWxlY3RvciIsInJlcGxhY2UiLCJkYXRhc2V0Iiwic3RhdHVzIiwiZm9ybSIsIkZvcm1EYXRhIiwiYXBwZW5kIiwibmFtZSIsIm5leHRFbGVtZW50U2libGluZyIsImlubmVySFRNTCIsImxpc3QiLCJkYXRhIiwiYWpheCIsInVuZGVmaW5lZCIsImNhcGFiaWxpdGllcyIsIm1heWJlRGlzYWJsZU9wdGlvbnMiLCJpbnB1dHMiLCJxdWVyeVNlbGVjdG9yQWxsIiwib3B0aW9ucyIsImZvckVhY2giLCJpbnB1dCIsInZhbGlkYXRlSW5wdXQiLCJwdXNoIiwiSlNPTiIsInN0cmluZ2lmeSIsImNoaWxkcmVuIiwicmVtb3ZlIiwic2V0QXR0cmlidXRlIiwib3B0aW9uIiwiY2FwcyIsInNwbGl0IiwiZGlzYWJsZSIsImNhcCIsImRpc3BhdGNoRXZlbnQiLCJFdmVudCIsImJ1YmJsZXMiLCJtYXRjaCIsImdldEVsZW1lbnRzQnlUYWdOYW1lIiwidGhlbiIsInJlc3BvbnNlIiwic3VjY2VzcyIsInJlbW92ZUF0dHJpYnV0ZSIsImJ1dHRvbklzSHJlZiIsInNsaWRlX2lkIiwiZGlzYWJsZWQiLCJwcmV2ZW50RGVmYXVsdCIsImRvbWFpbiIsInJlcGxhY2VBbGwiLCJvcGVuIiwicGxhdXNpYmxlX2FuYWx5dGljc19ob3N0ZWRfZG9tYWluIiwic3Vic3RyaW5nIiwiYWxsU3RlcHMiLCJhY3RpdmVTdGVwcyIsImNvbXBsZXRlZFN0ZXBzIiwiY3VycmVudFN0ZXAiLCJpbmFjdGl2ZUN1cnJlbnRTdGVwIiwiY3VycmVudGx5Q29tcGxldGVkU3RlcHMiLCJmaWx0ZXIiLCJuIiwic3RlcCIsImNvbXBsZXRlZFN0ZXAiLCJpbmFjdGl2ZVN0ZXAiLCJmZXRjaCIsImFqYXh1cmwiLCJtZXRob2QiLCJib2R5IiwiaWQiLCJpbm5lclRleHQiLCJwbGF1c2libGVfYW5hbHl0aWNzX2kxOG4iLCJjb25uZWN0ZWQiLCJqc29uIiwiZXZlbnQiLCJDdXN0b21FdmVudCIsImRldGFpbCIsImZldGNoTWVzc2FnZXMiLCJtZXNzYWdlcyIsImVycm9yIiwic2hvd01lc3NhZ2UiLCJub3RpY2UiLCJhZGRpdGlvbmFsIiwibWVzc2FnZSIsInNob3dBZGRpdGlvbmFsTWVzc2FnZSIsInJlbW92ZUFkZGl0aW9uYWxNZXNzYWdlIiwiYWRkIiwic2V0VGltZW91dCIsImh0bWwiLCJjb250YWluZXIiLCJhZGRpdGlvbmFsTWVzc2FnZSIsInJlbW92ZUNoaWxkIl0sInNvdXJjZVJvb3QiOiIifQ==