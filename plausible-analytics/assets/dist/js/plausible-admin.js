document.addEventListener("DOMContentLoaded",(()=>{if(!document.location.href.includes("plausible_analytics"))return;let e={nonceElem:document.getElementById("_wpnonce"),nonce:"",showWizardElem:document.getElementById("show_wizard"),domainNameElem:document.getElementById("domain_name"),apiTokenElem:document.getElementById("api_token"),createAPITokenElems:document.getElementsByClassName("plausible-create-api-token"),buttonElems:document.getElementsByClassName("plausible-analytics-button"),stepElems:document.getElementsByClassName("plausible-analytics-wizard-next-step"),init:function(){if(""===document.location.hash&&null!==document.getElementById("plausible-analytics-wizard")&&(document.location.hash="#welcome_slide"),null!==this.nonceElem&&(this.nonce=this.nonceElem.value),this.toggleWizardStep(),window.addEventListener("hashchange",this.toggleWizardStep),null!==this.showWizardElem&&this.showWizardElem.addEventListener("click",this.showWizard),null!==this.domainNameElem&&this.domainNameElem.addEventListener("keyup",this.disableConnectButton),null!==this.apiTokenElem&&this.apiTokenElem.addEventListener("keyup",this.disableConnectButton),this.createAPITokenElems.length>0)for(let e=0;e<this.createAPITokenElems.length;e++)this.createAPITokenElems[e].addEventListener("click",this.createAPIToken);if(this.buttonElems.length>0)for(let e=0;e<this.buttonElems.length;e++)this.buttonElems[e].addEventListener("click",this.saveOption);if(document.addEventListener("click",this.toggleOption),this.stepElems.length>0)for(let e=0;e<this.stepElems.length;e++)this.stepElems[e].addEventListener("click",this.saveOptionOnNext);this.showMessages()},toggleOption:function(t){if(null===t.target.classList||!t.target.classList.contains("plausible-analytics-toggle"))return;const n=t.target.closest("button");let s,a;s="submit"===t.target.type?n.querySelector("span"):t.target.closest("span"),n.classList.contains("bg-indigo-600")?(n.classList.replace("bg-indigo-600","bg-gray-200"),s.classList.replace("translate-x-5","translate-x-0"),a=""):(n.classList.replace("bg-gray-200","bg-indigo-600"),s.classList.replace("translate-x-0","translate-x-5"),a="on");const i=new FormData;i.append("action","plausible_analytics_toggle_option"),i.append("option_name",n.name),i.append("option_value",n.value),i.append("option_label",n.nextElementSibling.innerHTML),i.append("toggle_status",a),i.append("is_list",n.dataset.list),i.append("_nonce",e.nonce),e.ajax(i)},saveOption:function(t){const n=t.target,s=n.closest(".plausible-analytics-section").querySelectorAll("input, textarea"),a=new FormData,i=[];s.forEach((function(t){t=e.validateInput(t),i.push({name:t.name,value:t.value})})),a.append("action","plausible_analytics_save_options"),a.append("options",JSON.stringify(i)),a.append("_nonce",e.nonce),n.children.length>0&&n.children[0].classList.remove("hidden"),n.setAttribute("disabled","disabled"),e.ajax(a,n)},validateInput:function(e){return"domain_name"===e.name&&e.value.match(/^(https?:\/\/)?(www.)?/).length>0&&(e.value=e.value.replace(/^(https?:\/\/)?(www.)?/,"")),e},saveOptionOnNext:function(t){let n=document.location.hash.replace("#","");if("api_token_slide"!==n&&"domain_name_slide"!==n)return;let s=t.target.closest(".plausible-analytics-wizard-step-section").getElementsByTagName("INPUT"),a=[];for(let t of s)t=e.validateInput(t),a.push({name:t.name,value:t.value});let i=new FormData;i.append("action","plausible_analytics_save_options"),i.append("options",JSON.stringify(a)),i.append("_nonce",e.nonce),e.ajax(i).then((e=>{"api_token_slide"===n&&!0===e.success&&document.getElementById("enable_analytics_dashboard_view_stats_in_wordpress").removeAttribute("disabled")}))},disableConnectButton:function(e){let t=e.target,n=document.getElementById("connect_plausible_analytics"),s=!1;if(null===n){let e=document.location.hash;n=document.querySelector(e+" .plausible-analytics-wizard-next-step"),s=!0}null!==n&&(""===t.value?s?(n.classList+=" pointer-events-none",n.classList.replace("bg-indigo-600","bg-gray-200")):(n.disabled=!0,n.innerHTML=n.innerHTML.replace("Connected","Connect")):s?(n.classList.remove("pointer-events-none"),n.classList.replace("bg-gray-200","bg-indigo-600")):n.disabled=!1)},createAPIToken:function(e){e.preventDefault();let t=document.getElementById("domain_name").value;t=t.replaceAll("/","%2F"),window.open(`${plausible_analytics_hosted_domain}/${t}/settings/integrations?new_token=WordPress`,"_blank","location=yes,height=768,width=1024,scrollbars=yes,status=no")},showWizard:function(t){let n=new FormData;n.append("action","plausible_analytics_show_wizard"),n.append("_nonce",t.target.dataset.nonce),e.ajax(n)},toggleWizardStep:function(){if(null===document.getElementById("plausible-analytics-wizard"))return;const e=document.location.hash.substring(1).replace("_slide","");let t=document.querySelectorAll(".plausible-analytics-wizard-step"),n=document.querySelectorAll(".plausible-analytics-wizard-active-step"),s=document.querySelectorAll(".plausible-analytics-wizard-completed-step");for(let e=0;e<t.length;e++)t[e].classList.remove("hidden");for(let e=0;e<n.length;e++)n[e].classList+=" hidden";for(let e=0;e<s.length;e++)s[e].classList+=" hidden";let a=document.getElementById("active-step-"+e),i=document.getElementById("step-"+e);a.classList.remove("hidden"),i.classList+=" hidden";let l=a.dataset.completedSteps.split(",");l=l.filter((e=>e)),l.length<1||l.forEach((function(e){let t=document.getElementById("completed-step-"+e),n=document.getElementById("step-"+e);t.classList.remove("hidden"),n.classList+=" hidden"}))},ajax:function(t,n=null,s=!0){return fetch(ajaxurl,{method:"POST",body:t}).then((e=>(n&&(n.children.length>0&&(n.children[0].classList+=" hidden"),"connect_plausible_analytics"===n.id&&200===e.status?n.innerText=plausible_analytics_i18n.connected:n.removeAttribute("disabled")),200===e.status&&e.json()))).then((t=>{!0===s&&e.showMessages();let n=new CustomEvent("plausibleAjaxDone",{detail:t});return document.dispatchEvent(n),void 0!==t.data?t.data:t}))},showMessages:function(){e.fetchMessages().then((function(t){!1!==t.error?e.showMessage(t.error,"error"):!1!==t.notice?e.showMessage(t.notice,"notice"):!1!==t.success&&e.showMessage(t.success,"success"),0!==t.additional.length&&null===document.getElementById("plausible-analytics-wizard")&&(void 0!==t.additional.id&&t.additional.message?e.showAdditionalMessage(t.additional.message,t.additional.id):void 0!==t.additional.id&&""===t.additional.message&&e.removeAdditionalMessage(t.additional.id))}))},fetchMessages:function(){let t=new FormData;return t.append("action","plausible_analytics_messages"),e.ajax(t,null,!1).then((function(e){return e}))},showMessage:function(e,t="success"){"error"===t?(document.getElementById("icon-error").classList.remove("hidden"),document.getElementById("icon-success").classList.add("hidden"),document.getElementById("icon-notice").classList.add("hidden")):"notice"===t?(document.getElementById("icon-notice").classList.remove("hidden"),document.getElementById("icon-error").classList.add("hidden"),document.getElementById("icon-success").classList.add("hidden")):(document.getElementById("icon-success").classList.remove("hidden"),document.getElementById("icon-error").classList.add("hidden"),document.getElementById("icon-notice").classList.add("hidden"));let n=document.getElementById("plausible-analytics-notice");document.getElementById("plausible-analytics-notice-text").innerHTML=e,n.classList.remove("hidden"),setTimeout((function(){n.classList.replace("opacity-0","opacity-100")}),200),"error"!==t&&setTimeout((function(){n.classList.replace("opacity-100","opacity-0"),setTimeout((function(){n.classList+=" hidden"}),200)}),2e3)},showAdditionalMessage:function(e,t){let n=document.querySelector(`[name='${t}']`).closest(".plausible-analytics-group");if(n.children.length>0)for(let e=0;e<n.children.length;e++)if(n.children[e].id.includes(t))return;n.innerHTML+=e},removeAdditionalMessage:function(e){let t,n=document.querySelector(`[name="${e}"]`).closest(".plausible-analytics-group");if(n.children.length>0)for(let e=0;e<n.children.length;e++)if(n.children[e].classList.contains("plausible-analytics-hook")){t=n.children[e];break}void 0===t||t.classList.contains("plausible-analytics-persist")||n.removeChild(t)}};e.init()}));
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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RixTQUFTNEIsR0FFckMsT0FLSHNGLEVBQVV2RSxXQUFhc0UsQ0FDeEIsRUFPQUgsd0JBQXlCLFNBQVVsRixHQUNsQyxJQUVJdUYsRUFEQUQsRUFEYXRILFNBQVN3QyxjQUFjLFVBQVVSLE9BQ3ZCSSxRQUFRLDhCQUduQyxHQUFJa0YsRUFBVTFELFNBQVNwQyxPQUFTLEVBQy9CLElBQUssSUFBSUMsRUFBSSxFQUFHQSxFQUFJNkYsRUFBVTFELFNBQVNwQyxPQUFRQyxJQUM5QyxHQUFJNkYsRUFBVTFELFNBQVNuQyxHQUFHUSxVQUFVQyxTQUFTLDRCQUE2QixDQUN6RXFGLEVBQW9CRCxFQUFVMUQsU0FBU25DLEdBRXZDLEtBQ0QsTUFJd0JnRixJQUF0QmMsR0FBb0NBLEVBQWtCdEYsVUFBVUMsU0FBUyxnQ0FDNUVvRixFQUFVRSxZQUFZRCxFQUV4QixHQUdEbEgsRUFBVVcsTUFBTSIsInNvdXJjZXMiOlsid2VicGFjazovL3BsYXVzaWJsZS1hbmFseXRpY3MvLi9hc3NldHMvc3JjL2pzL2FkbWluL21haW4uanMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBQbGF1c2libGUgQW5hbHl0aWNzXG4gKlxuICogQWRtaW4gSlNcbiAqL1xuZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsICgpID0+IHtcblx0aWYgKCFkb2N1bWVudC5sb2NhdGlvbi5ocmVmLmluY2x1ZGVzKCdwbGF1c2libGVfYW5hbHl0aWNzJykpIHtcblx0XHRyZXR1cm47XG5cdH1cblxuXHRsZXQgcGxhdXNpYmxlID0ge1xuXHRcdC8qKlxuXHRcdCAqIFByb3BlcnRpZXNcblx0XHQgKi9cblx0XHRub25jZUVsZW06IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdfd3Bub25jZScpLFxuXHRcdG5vbmNlOiAnJyxcblx0XHRzaG93V2l6YXJkRWxlbTogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Nob3dfd2l6YXJkJyksXG5cdFx0ZG9tYWluTmFtZUVsZW06IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkb21haW5fbmFtZScpLFxuXHRcdGFwaVRva2VuRWxlbTogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2FwaV90b2tlbicpLFxuXHRcdGNyZWF0ZUFQSVRva2VuRWxlbXM6IGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoJ3BsYXVzaWJsZS1jcmVhdGUtYXBpLXRva2VuJyksXG5cdFx0YnV0dG9uRWxlbXM6IGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoJ3BsYXVzaWJsZS1hbmFseXRpY3MtYnV0dG9uJyksXG5cdFx0c3RlcEVsZW1zOiBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCdwbGF1c2libGUtYW5hbHl0aWNzLXdpemFyZC1uZXh0LXN0ZXAnKSxcblxuXHRcdC8qKlxuXHRcdCAqIEJpbmQgZXZlbnRzLlxuXHRcdCAqL1xuXHRcdGluaXQ6IGZ1bmN0aW9uICgpIHtcblx0XHRcdGlmIChkb2N1bWVudC5sb2NhdGlvbi5oYXNoID09PSAnJyAmJiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGxhdXNpYmxlLWFuYWx5dGljcy13aXphcmQnKSAhPT0gbnVsbCkge1xuXHRcdFx0XHRkb2N1bWVudC5sb2NhdGlvbi5oYXNoID0gJyN3ZWxjb21lX3NsaWRlJztcblx0XHRcdH1cblxuXHRcdFx0aWYgKHRoaXMubm9uY2VFbGVtICE9PSBudWxsKSB7XG5cdFx0XHRcdHRoaXMubm9uY2UgPSB0aGlzLm5vbmNlRWxlbS52YWx1ZTtcblx0XHRcdH1cblxuXHRcdFx0dGhpcy50b2dnbGVXaXphcmRTdGVwKCk7XG5cblx0XHRcdHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdoYXNoY2hhbmdlJywgdGhpcy50b2dnbGVXaXphcmRTdGVwKTtcblxuXHRcdFx0aWYgKHRoaXMuc2hvd1dpemFyZEVsZW0gIT09IG51bGwpIHtcblx0XHRcdFx0dGhpcy5zaG93V2l6YXJkRWxlbS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMuc2hvd1dpemFyZCk7XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0aGlzLmRvbWFpbk5hbWVFbGVtICE9PSBudWxsKSB7XG5cdFx0XHRcdHRoaXMuZG9tYWluTmFtZUVsZW0uYWRkRXZlbnRMaXN0ZW5lcigna2V5dXAnLCB0aGlzLmRpc2FibGVDb25uZWN0QnV0dG9uKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKHRoaXMuYXBpVG9rZW5FbGVtICE9PSBudWxsKSB7XG5cdFx0XHRcdHRoaXMuYXBpVG9rZW5FbGVtLmFkZEV2ZW50TGlzdGVuZXIoJ2tleXVwJywgdGhpcy5kaXNhYmxlQ29ubmVjdEJ1dHRvbik7XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0aGlzLmNyZWF0ZUFQSVRva2VuRWxlbXMubGVuZ3RoID4gMCkge1xuXHRcdFx0XHRmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuY3JlYXRlQVBJVG9rZW5FbGVtcy5sZW5ndGg7IGkrKykge1xuXHRcdFx0XHRcdHRoaXMuY3JlYXRlQVBJVG9rZW5FbGVtc1tpXS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMuY3JlYXRlQVBJVG9rZW4pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0aGlzLmJ1dHRvbkVsZW1zLmxlbmd0aCA+IDApIHtcblx0XHRcdFx0Zm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmJ1dHRvbkVsZW1zLmxlbmd0aDsgaSsrKSB7XG5cdFx0XHRcdFx0dGhpcy5idXR0b25FbGVtc1tpXS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMuc2F2ZU9wdGlvbik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0LyoqXG5cdFx0XHQgKiBEdWUgdG8gdGhlIHN0cnVjdHVyZSBvZiB0aGUgdG9nZ2xlcywgYW55IGV2ZW50cyBib3VuZCB0byB0aGVtIHdvdWxkIGJlIHRyaWdnZXJlZCB0d2ljZSwgdGhhdCdzIHdoeSB3ZSBiaW5kIGl0IHRvIHRoZSBkb2N1bWVudHMnIGNsaWNrJ1xuXHRcdFx0ICogZXZlbnQuXG5cdFx0XHQgKi9cblx0XHRcdGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy50b2dnbGVPcHRpb24pO1xuXG5cdFx0XHRpZiAodGhpcy5zdGVwRWxlbXMubGVuZ3RoID4gMCkge1xuXHRcdFx0XHRmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuc3RlcEVsZW1zLmxlbmd0aDsgaSsrKSB7XG5cdFx0XHRcdFx0dGhpcy5zdGVwRWxlbXNbaV0uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzLnNhdmVPcHRpb25Pbk5leHQpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdC8qKlxuXHRcdFx0ICogUnVuIG9uY2Ugb24gcGFnZWxvYWQuXG5cdFx0XHQgKi9cblx0XHRcdHRoaXMuc2hvd01lc3NhZ2VzKCk7XG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIFRvZ2dsZSBPcHRpb24gYW5kIHN0b3JlIGluIERCLlxuXHRcdCAqXG5cdFx0ICogQHBhcmFtIGVcblx0XHQgKi9cblx0XHR0b2dnbGVPcHRpb246IGZ1bmN0aW9uIChlKSB7XG5cdFx0XHQvKipcblx0XHRcdCAqIE1ha2Ugc3VyZSBldmVudCB0YXJnZXQgaXMgYSB0b2dnbGUuXG5cdFx0XHQgKi9cblx0XHRcdGlmIChlLnRhcmdldC5jbGFzc0xpc3QgPT09IG51bGwgfHwgIWUudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygncGxhdXNpYmxlLWFuYWx5dGljcy10b2dnbGUnKSkge1xuXHRcdFx0XHRyZXR1cm47XG5cdFx0XHR9XG5cblx0XHRcdGNvbnN0IGJ1dHRvbiA9IGUudGFyZ2V0LmNsb3Nlc3QoJ2J1dHRvbicpO1xuXHRcdFx0bGV0IHRvZ2dsZTtcblxuXHRcdFx0Ly8gVGhlIGJ1dHRvbiBlbGVtZW50IGlzIGNsaWNrZWQuXG5cdFx0XHRpZiAoZS50YXJnZXQudHlwZSA9PT0gJ3N1Ym1pdCcpIHtcblx0XHRcdFx0dG9nZ2xlID0gYnV0dG9uLnF1ZXJ5U2VsZWN0b3IoJ3NwYW4nKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdC8vIFRoZSBzcGFuIGVsZW1lbnQgaXMgY2xpY2tlZC5cblx0XHRcdFx0dG9nZ2xlID0gZS50YXJnZXQuY2xvc2VzdCgnc3BhbicpO1xuXHRcdFx0fVxuXG5cdFx0XHRsZXQgdG9nZ2xlU3RhdHVzO1xuXG5cdFx0XHRpZiAoYnV0dG9uLmNsYXNzTGlzdC5jb250YWlucygnYmctaW5kaWdvLTYwMCcpKSB7XG5cdFx0XHRcdC8vIFRvZ2dsZTogb2ZmXG5cdFx0XHRcdGJ1dHRvbi5jbGFzc0xpc3QucmVwbGFjZSgnYmctaW5kaWdvLTYwMCcsICdiZy1ncmF5LTIwMCcpO1xuXHRcdFx0XHR0b2dnbGUuY2xhc3NMaXN0LnJlcGxhY2UoJ3RyYW5zbGF0ZS14LTUnLCAndHJhbnNsYXRlLXgtMCcpO1xuXHRcdFx0XHR0b2dnbGVTdGF0dXMgPSAnJztcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdC8vIFRvZ2dsZTogb25cblx0XHRcdFx0YnV0dG9uLmNsYXNzTGlzdC5yZXBsYWNlKCdiZy1ncmF5LTIwMCcsICdiZy1pbmRpZ28tNjAwJyk7XG5cdFx0XHRcdHRvZ2dsZS5jbGFzc0xpc3QucmVwbGFjZSgndHJhbnNsYXRlLXgtMCcsICd0cmFuc2xhdGUteC01Jyk7XG5cdFx0XHRcdHRvZ2dsZVN0YXR1cyA9ICdvbic7XG5cdFx0XHR9XG5cblx0XHRcdGNvbnN0IGZvcm0gPSBuZXcgRm9ybURhdGEoKTtcblx0XHRcdGZvcm0uYXBwZW5kKCdhY3Rpb24nLCAncGxhdXNpYmxlX2FuYWx5dGljc190b2dnbGVfb3B0aW9uJyk7XG5cdFx0XHRmb3JtLmFwcGVuZCgnb3B0aW9uX25hbWUnLCBidXR0b24ubmFtZSk7XG5cdFx0XHRmb3JtLmFwcGVuZCgnb3B0aW9uX3ZhbHVlJywgYnV0dG9uLnZhbHVlKTtcblx0XHRcdGZvcm0uYXBwZW5kKCdvcHRpb25fbGFiZWwnLCBidXR0b24ubmV4dEVsZW1lbnRTaWJsaW5nLmlubmVySFRNTCk7XG5cdFx0XHRmb3JtLmFwcGVuZCgndG9nZ2xlX3N0YXR1cycsIHRvZ2dsZVN0YXR1cyk7XG5cdFx0XHRmb3JtLmFwcGVuZCgnaXNfbGlzdCcsIGJ1dHRvbi5kYXRhc2V0Lmxpc3QpO1xuXHRcdFx0Zm9ybS5hcHBlbmQoJ19ub25jZScsIHBsYXVzaWJsZS5ub25jZSk7XG5cblx0XHRcdHBsYXVzaWJsZS5hamF4KGZvcm0pO1xuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBTYXZlIHZhbHVlIG9mIGlucHV0IG9yIHRleHQgYXJlYSB0byBEQi5cblx0XHQgKlxuXHRcdCAqIEBwYXJhbSBlXG5cdFx0ICovXG5cdFx0c2F2ZU9wdGlvbjogZnVuY3Rpb24gKGUpIHtcblx0XHRcdGNvbnN0IGJ1dHRvbiA9IGUudGFyZ2V0O1xuXHRcdFx0Y29uc3Qgc2VjdGlvbiA9IGJ1dHRvbi5jbG9zZXN0KCcucGxhdXNpYmxlLWFuYWx5dGljcy1zZWN0aW9uJyk7XG5cdFx0XHRjb25zdCBpbnB1dHMgPSBzZWN0aW9uLnF1ZXJ5U2VsZWN0b3JBbGwoJ2lucHV0LCB0ZXh0YXJlYScpO1xuXHRcdFx0Y29uc3QgZm9ybSA9IG5ldyBGb3JtRGF0YSgpO1xuXHRcdFx0Y29uc3Qgb3B0aW9ucyA9IFtdO1xuXG5cdFx0XHRpbnB1dHMuZm9yRWFjaChmdW5jdGlvbiAoaW5wdXQpIHtcblx0XHRcdFx0aW5wdXQgPSBwbGF1c2libGUudmFsaWRhdGVJbnB1dChpbnB1dCk7XG5cblx0XHRcdFx0b3B0aW9ucy5wdXNoKHtuYW1lOiBpbnB1dC5uYW1lLCB2YWx1ZTogaW5wdXQudmFsdWV9KTtcblx0XHRcdH0pO1xuXG5cdFx0XHRmb3JtLmFwcGVuZCgnYWN0aW9uJywgJ3BsYXVzaWJsZV9hbmFseXRpY3Nfc2F2ZV9vcHRpb25zJyk7XG5cdFx0XHRmb3JtLmFwcGVuZCgnb3B0aW9ucycsIEpTT04uc3RyaW5naWZ5KG9wdGlvbnMpKTtcblx0XHRcdGZvcm0uYXBwZW5kKCdfbm9uY2UnLCBwbGF1c2libGUubm9uY2UpO1xuXG5cdFx0XHRpZiAoYnV0dG9uLmNoaWxkcmVuLmxlbmd0aCA+IDApIHtcblx0XHRcdFx0YnV0dG9uLmNoaWxkcmVuWzBdLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpO1xuXHRcdFx0fVxuXG5cdFx0XHRidXR0b24uc2V0QXR0cmlidXRlKCdkaXNhYmxlZCcsICdkaXNhYmxlZCcpO1xuXG5cdFx0XHRwbGF1c2libGUuYWpheChmb3JtLCBidXR0b24pO1xuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBDdXJyZW50bHkgb25seSB2YWxpZGF0ZXMgdGhlIGRvbWFpbl9uYW1lIGlucHV0LCBidXQgY2FuIGJlIHVzZWQgaW4gdGhlIGZ1dHVyZSBmb3Igb3RoZXIgY3VzdG9tIGlucHV0IHZhbGlkYXRpb25zLlxuXHRcdCAqXG5cdFx0ICogQHBhcmFtIGlucHV0XG5cdFx0ICogQHJldHVybnMgeyp9XG5cdFx0ICovXG5cdFx0dmFsaWRhdGVJbnB1dDogZnVuY3Rpb24gKGlucHV0KSB7XG5cdFx0XHQvLyBTdHJpcCBodHRwKHMpOi8vKHd3dy4pIGZyb20gZG9tYWluX25hbWUgYmVmb3JlIHNlbmRpbmcgaXQuXG5cdFx0XHRpZiAoaW5wdXQubmFtZSA9PT0gJ2RvbWFpbl9uYW1lJyAmJiBpbnB1dC52YWx1ZS5tYXRjaCgvXihodHRwcz86XFwvXFwvKT8od3d3Lik/LykubGVuZ3RoID4gMCkge1xuXHRcdFx0XHRpbnB1dC52YWx1ZSA9IGlucHV0LnZhbHVlLnJlcGxhY2UoL14oaHR0cHM/OlxcL1xcLyk/KHd3dy4pPy8sICcnKTtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIGlucHV0O1xuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBTYXZlIE9wdGlvbnMgb24gTmV4dCBjbGljayBmb3IgQVBJIFRva2VuIGFuZCBEb21haW4gTmFtZSBzbGlkZXMuXG5cdFx0ICpcblx0XHQgKiBAcGFyYW0gZVxuXHRcdCAqL1xuXHRcdHNhdmVPcHRpb25Pbk5leHQ6IGZ1bmN0aW9uIChlKSB7XG5cdFx0XHRsZXQgaGFzaCA9IGRvY3VtZW50LmxvY2F0aW9uLmhhc2gucmVwbGFjZSgnIycsICcnKTtcblxuXHRcdFx0aWYgKGhhc2ggIT09ICdhcGlfdG9rZW5fc2xpZGUnICYmIGhhc2ggIT09ICdkb21haW5fbmFtZV9zbGlkZScpIHtcblx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0fVxuXG5cdFx0XHRsZXQgZm9ybSA9IGUudGFyZ2V0LmNsb3Nlc3QoJy5wbGF1c2libGUtYW5hbHl0aWNzLXdpemFyZC1zdGVwLXNlY3Rpb24nKTtcblx0XHRcdGxldCBpbnB1dHMgPSBmb3JtLmdldEVsZW1lbnRzQnlUYWdOYW1lKCdJTlBVVCcpO1xuXHRcdFx0bGV0IG9wdGlvbnMgPSBbXTtcblxuXHRcdFx0Zm9yIChsZXQgaW5wdXQgb2YgaW5wdXRzKSB7XG5cdFx0XHRcdGlucHV0ID0gcGxhdXNpYmxlLnZhbGlkYXRlSW5wdXQoaW5wdXQpO1xuXG5cdFx0XHRcdG9wdGlvbnMucHVzaCh7bmFtZTogaW5wdXQubmFtZSwgdmFsdWU6IGlucHV0LnZhbHVlfSk7XG5cdFx0XHR9XG5cblx0XHRcdGxldCBkYXRhID0gbmV3IEZvcm1EYXRhKCk7XG5cblx0XHRcdGRhdGEuYXBwZW5kKCdhY3Rpb24nLCAncGxhdXNpYmxlX2FuYWx5dGljc19zYXZlX29wdGlvbnMnKTtcblx0XHRcdGRhdGEuYXBwZW5kKCdvcHRpb25zJywgSlNPTi5zdHJpbmdpZnkob3B0aW9ucykpO1xuXHRcdFx0ZGF0YS5hcHBlbmQoJ19ub25jZScsIHBsYXVzaWJsZS5ub25jZSk7XG5cblx0XHRcdHBsYXVzaWJsZS5hamF4KGRhdGEpLnRoZW4ocmVzcG9uc2UgPT4ge1xuXHRcdFx0XHQvKipcblx0XHRcdFx0ICogRGlzYWJsZSBWaWV3IFN0YXRzIGJ1dHRvbiwgaWYgQVBJIHRva2VuIGlzIGVudGVyZWQgYW5kIHZhbGlkLlxuXHRcdFx0XHQgKi9cblx0XHRcdFx0aWYgKGhhc2ggPT09ICdhcGlfdG9rZW5fc2xpZGUnICYmIHJlc3BvbnNlLnN1Y2Nlc3MgPT09IHRydWUpIHtcblx0XHRcdFx0XHRsZXQgc3RhdHNfYnV0dG9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2VuYWJsZV9hbmFseXRpY3NfZGFzaGJvYXJkX3ZpZXdfc3RhdHNfaW5fd29yZHByZXNzJyk7XG5cblx0XHRcdFx0XHRzdGF0c19idXR0b24ucmVtb3ZlQXR0cmlidXRlKCdkaXNhYmxlZCcpO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogRGlzYWJsZSBDb25uZWN0IGJ1dHRvbiBpZiBEb21haW4gTmFtZSBvciBBUEkgVG9rZW4gZmllbGQgaXMgZW1wdHkuXG5cdFx0ICpcblx0XHQgKiBAcGFyYW0gZVxuXHRcdCAqL1xuXHRcdGRpc2FibGVDb25uZWN0QnV0dG9uOiBmdW5jdGlvbiAoZSkge1xuXHRcdFx0bGV0IHRhcmdldCA9IGUudGFyZ2V0O1xuXHRcdFx0bGV0IGJ1dHRvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjb25uZWN0X3BsYXVzaWJsZV9hbmFseXRpY3MnKTtcblx0XHRcdGxldCBidXR0b25Jc0hyZWYgPSBmYWxzZTtcblxuXHRcdFx0aWYgKGJ1dHRvbiA9PT0gbnVsbCkge1xuXHRcdFx0XHRsZXQgc2xpZGVfaWQgPSBkb2N1bWVudC5sb2NhdGlvbi5oYXNoO1xuXHRcdFx0XHRidXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHNsaWRlX2lkICsgJyAucGxhdXNpYmxlLWFuYWx5dGljcy13aXphcmQtbmV4dC1zdGVwJyk7XG5cdFx0XHRcdGJ1dHRvbklzSHJlZiA9IHRydWU7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChidXR0b24gPT09IG51bGwpIHtcblx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAodGFyZ2V0LnZhbHVlICE9PSAnJykge1xuXHRcdFx0XHRpZiAoIWJ1dHRvbklzSHJlZikge1xuXHRcdFx0XHRcdGJ1dHRvbi5kaXNhYmxlZCA9IGZhbHNlO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGJ1dHRvbi5jbGFzc0xpc3QucmVtb3ZlKCdwb2ludGVyLWV2ZW50cy1ub25lJyk7XG5cdFx0XHRcdFx0YnV0dG9uLmNsYXNzTGlzdC5yZXBsYWNlKCdiZy1ncmF5LTIwMCcsICdiZy1pbmRpZ28tNjAwJylcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybjtcblx0XHRcdH1cblxuXHRcdFx0aWYgKCFidXR0b25Jc0hyZWYpIHtcblx0XHRcdFx0YnV0dG9uLmRpc2FibGVkID0gdHJ1ZTtcblx0XHRcdFx0YnV0dG9uLmlubmVySFRNTCA9IGJ1dHRvbi5pbm5lckhUTUwucmVwbGFjZSgnQ29ubmVjdGVkJywgJ0Nvbm5lY3QnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGJ1dHRvbi5jbGFzc0xpc3QgKz0gJyBwb2ludGVyLWV2ZW50cy1ub25lJztcblx0XHRcdFx0YnV0dG9uLmNsYXNzTGlzdC5yZXBsYWNlKCdiZy1pbmRpZ28tNjAwJywgJ2JnLWdyYXktMjAwJylcblx0XHRcdH1cblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogT3BlbiBjcmVhdGUgQVBJIHRva2VuIGRpYWxvZy5cblx0XHQgKlxuXHRcdCAqIEBwYXJhbSBlXG5cdFx0ICovXG5cdFx0Y3JlYXRlQVBJVG9rZW46IGZ1bmN0aW9uIChlKSB7XG5cdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cblx0XHRcdGxldCBkb21haW4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZG9tYWluX25hbWUnKS52YWx1ZTtcblx0XHRcdGRvbWFpbiA9IGRvbWFpbi5yZXBsYWNlQWxsKCcvJywgJyUyRicpO1xuXG5cdFx0XHR3aW5kb3cub3BlbihgJHtwbGF1c2libGVfYW5hbHl0aWNzX2hvc3RlZF9kb21haW59LyR7ZG9tYWlufS9zZXR0aW5ncy9pbnRlZ3JhdGlvbnM/bmV3X3Rva2VuPVdvcmRQcmVzc2AsICdfYmxhbmsnLCAnbG9jYXRpb249eWVzLGhlaWdodD03Njgsd2lkdGg9MTAyNCxzY3JvbGxiYXJzPXllcyxzdGF0dXM9bm8nKTtcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogU2hvdyB3aXphcmQuXG5cdFx0ICpcblx0XHQgKiBAcGFyYW0gZVxuXHRcdCAqL1xuXHRcdHNob3dXaXphcmQ6IGZ1bmN0aW9uIChlKSB7XG5cdFx0XHRsZXQgZGF0YSA9IG5ldyBGb3JtRGF0YSgpO1xuXHRcdFx0ZGF0YS5hcHBlbmQoJ2FjdGlvbicsICdwbGF1c2libGVfYW5hbHl0aWNzX3Nob3dfd2l6YXJkJyk7XG5cdFx0XHRkYXRhLmFwcGVuZCgnX25vbmNlJywgZS50YXJnZXQuZGF0YXNldC5ub25jZSk7XG5cblx0XHRcdHBsYXVzaWJsZS5hamF4KGRhdGEpO1xuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBUb2dnbGVzIHRoZSBhY3RpdmUvaW5hY3RpdmUvY3VycmVudCBzdGF0ZSBvZiB0aGUgc3RlcHMuXG5cdFx0ICovXG5cdFx0dG9nZ2xlV2l6YXJkU3RlcDogZnVuY3Rpb24gKCkge1xuXHRcdFx0aWYgKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwbGF1c2libGUtYW5hbHl0aWNzLXdpemFyZCcpID09PSBudWxsKSB7XG5cdFx0XHRcdHJldHVybjtcblx0XHRcdH1cblxuXHRcdFx0Y29uc3QgaGFzaCA9IGRvY3VtZW50LmxvY2F0aW9uLmhhc2guc3Vic3RyaW5nKDEpLnJlcGxhY2UoJ19zbGlkZScsICcnKTtcblxuXHRcdFx0LyoqXG5cdFx0XHQgKiBSZXNldCBhbGwgc3RlcHMgdG8gaW5hY3RpdmUuXG5cdFx0XHQgKi9cblx0XHRcdGxldCBhbGxTdGVwcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5wbGF1c2libGUtYW5hbHl0aWNzLXdpemFyZC1zdGVwJyk7XG5cdFx0XHRsZXQgYWN0aXZlU3RlcHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcucGxhdXNpYmxlLWFuYWx5dGljcy13aXphcmQtYWN0aXZlLXN0ZXAnKTtcblx0XHRcdGxldCBjb21wbGV0ZWRTdGVwcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5wbGF1c2libGUtYW5hbHl0aWNzLXdpemFyZC1jb21wbGV0ZWQtc3RlcCcpO1xuXG5cdFx0XHRmb3IgKGxldCBpID0gMDsgaSA8IGFsbFN0ZXBzLmxlbmd0aDsgaSsrKSB7XG5cdFx0XHRcdGFsbFN0ZXBzW2ldLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpO1xuXHRcdFx0fVxuXG5cdFx0XHRmb3IgKGxldCBpID0gMDsgaSA8IGFjdGl2ZVN0ZXBzLmxlbmd0aDsgaSsrKSB7XG5cdFx0XHRcdGFjdGl2ZVN0ZXBzW2ldLmNsYXNzTGlzdCArPSAnIGhpZGRlbic7XG5cdFx0XHR9XG5cblx0XHRcdGZvciAobGV0IGkgPSAwOyBpIDwgY29tcGxldGVkU3RlcHMubGVuZ3RoOyBpKyspIHtcblx0XHRcdFx0Y29tcGxldGVkU3RlcHNbaV0uY2xhc3NMaXN0ICs9ICcgaGlkZGVuJztcblx0XHRcdH1cblxuXHRcdFx0LyoqXG5cdFx0XHQgKiBNYXJrIGN1cnJlbnQgc3RlcCBhcyBhY3RpdmUuXG5cdFx0XHQgKi9cblx0XHRcdGxldCBjdXJyZW50U3RlcCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhY3RpdmUtc3RlcC0nICsgaGFzaCk7XG5cdFx0XHRsZXQgaW5hY3RpdmVDdXJyZW50U3RlcCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzdGVwLScgKyBoYXNoKTtcblxuXHRcdFx0Y3VycmVudFN0ZXAuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7XG5cdFx0XHRpbmFjdGl2ZUN1cnJlbnRTdGVwLmNsYXNzTGlzdCArPSAnIGhpZGRlbic7XG5cblx0XHRcdC8qKlxuXHRcdFx0ICogTWFyayBzdGVwcyBhcyBjb21wbGV0ZWQuXG5cdFx0XHQgKlxuXHRcdFx0ICogQHR5cGUge3N0cmluZ1tdfVxuXHRcdFx0ICovXG5cdFx0XHRsZXQgY3VycmVudGx5Q29tcGxldGVkU3RlcHMgPSBjdXJyZW50U3RlcC5kYXRhc2V0LmNvbXBsZXRlZFN0ZXBzLnNwbGl0KCcsJyk7XG5cblx0XHRcdC8qKlxuXHRcdFx0ICogRmlsdGVyIGVtcHR5IGFycmF5IGVsZW1lbnRzLlxuXHRcdFx0ICogQHR5cGUge3N0cmluZ1tdfVxuXHRcdFx0ICovXG5cdFx0XHRjdXJyZW50bHlDb21wbGV0ZWRTdGVwcyA9IGN1cnJlbnRseUNvbXBsZXRlZFN0ZXBzLmZpbHRlcihuID0+IG4pO1xuXG5cdFx0XHRpZiAoY3VycmVudGx5Q29tcGxldGVkU3RlcHMubGVuZ3RoIDwgMSkge1xuXHRcdFx0XHRyZXR1cm47XG5cdFx0XHR9XG5cblx0XHRcdGN1cnJlbnRseUNvbXBsZXRlZFN0ZXBzLmZvckVhY2goZnVuY3Rpb24gKHN0ZXApIHtcblx0XHRcdFx0bGV0IGNvbXBsZXRlZFN0ZXAgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY29tcGxldGVkLXN0ZXAtJyArIHN0ZXApO1xuXHRcdFx0XHRsZXQgaW5hY3RpdmVTdGVwID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N0ZXAtJyArIHN0ZXApO1xuXG5cdFx0XHRcdGNvbXBsZXRlZFN0ZXAuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7XG5cdFx0XHRcdGluYWN0aXZlU3RlcC5jbGFzc0xpc3QgKz0gJyBoaWRkZW4nO1xuXHRcdFx0fSk7XG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIERvIEFKQVggcmVxdWVzdC5cblx0XHQgKlxuXHRcdCAqIEBwYXJhbSBkYXRhXG5cdFx0ICogQHBhcmFtIGJ1dHRvblxuXHRcdCAqIEBwYXJhbSBzaG93TWVzc2FnZXNcblx0XHQgKlxuXHRcdCAqIEByZXR1cm4gb2JqZWN0XG5cdFx0ICovXG5cdFx0YWpheDogZnVuY3Rpb24gKGRhdGEsIGJ1dHRvbiA9IG51bGwsIHNob3dNZXNzYWdlcyA9IHRydWUpIHtcblx0XHRcdHJldHVybiBmZXRjaChcblx0XHRcdFx0YWpheHVybCxcblx0XHRcdFx0e1xuXHRcdFx0XHRcdG1ldGhvZDogJ1BPU1QnLFxuXHRcdFx0XHRcdGJvZHk6IGRhdGEsXG5cdFx0XHRcdH1cblx0XHRcdCkudGhlbihyZXNwb25zZSA9PiB7XG5cdFx0XHRcdGlmIChidXR0b24pIHtcblx0XHRcdFx0XHRpZiAoYnV0dG9uLmNoaWxkcmVuLmxlbmd0aCA+IDApIHtcblx0XHRcdFx0XHRcdGJ1dHRvbi5jaGlsZHJlblswXS5jbGFzc0xpc3QgKz0gJyBoaWRkZW4nO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmIChidXR0b24uaWQgPT09ICdjb25uZWN0X3BsYXVzaWJsZV9hbmFseXRpY3MnICYmIHJlc3BvbnNlLnN0YXR1cyA9PT0gMjAwKSB7XG5cdFx0XHRcdFx0XHRidXR0b24uaW5uZXJUZXh0ID0gcGxhdXNpYmxlX2FuYWx5dGljc19pMThuLmNvbm5lY3RlZDtcblx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0YnV0dG9uLnJlbW92ZUF0dHJpYnV0ZSgnZGlzYWJsZWQnKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAocmVzcG9uc2Uuc3RhdHVzID09PSAyMDApIHtcblx0XHRcdFx0XHRyZXR1cm4gcmVzcG9uc2UuanNvbigpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdFx0fSkudGhlbihyZXNwb25zZSA9PiB7XG5cdFx0XHRcdGlmIChzaG93TWVzc2FnZXMgPT09IHRydWUpIHtcblx0XHRcdFx0XHRwbGF1c2libGUuc2hvd01lc3NhZ2VzKCk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRsZXQgZXZlbnQgPSBuZXcgQ3VzdG9tRXZlbnQoJ3BsYXVzaWJsZUFqYXhEb25lJywge2RldGFpbDogcmVzcG9uc2V9KTtcblxuXHRcdFx0XHRkb2N1bWVudC5kaXNwYXRjaEV2ZW50KGV2ZW50KTtcblxuXHRcdFx0XHRpZiAocmVzcG9uc2UuZGF0YSAhPT0gdW5kZWZpbmVkKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHJlc3BvbnNlLmRhdGE7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0cmV0dXJuIHJlc3BvbnNlO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogU2hvdyBtZXNzYWdlcyBvbiBzY3JlZW4uXG5cdFx0ICovXG5cdFx0c2hvd01lc3NhZ2VzOiBmdW5jdGlvbiAoKSB7XG5cdFx0XHRsZXQgbWVzc2FnZXMgPSBwbGF1c2libGUuZmV0Y2hNZXNzYWdlcygpO1xuXG5cdFx0XHRtZXNzYWdlcy50aGVuKGZ1bmN0aW9uIChtZXNzYWdlcykge1xuXHRcdFx0XHRpZiAobWVzc2FnZXMuZXJyb3IgIT09IGZhbHNlKSB7XG5cdFx0XHRcdFx0cGxhdXNpYmxlLnNob3dNZXNzYWdlKG1lc3NhZ2VzLmVycm9yLCAnZXJyb3InKTtcblx0XHRcdFx0fSBlbHNlIGlmIChtZXNzYWdlcy5ub3RpY2UgIT09IGZhbHNlKSB7XG5cdFx0XHRcdFx0cGxhdXNpYmxlLnNob3dNZXNzYWdlKG1lc3NhZ2VzLm5vdGljZSwgJ25vdGljZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKG1lc3NhZ2VzLnN1Y2Nlc3MgIT09IGZhbHNlKSB7XG5cdFx0XHRcdFx0cGxhdXNpYmxlLnNob3dNZXNzYWdlKG1lc3NhZ2VzLnN1Y2Nlc3MsICdzdWNjZXNzJyk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAobWVzc2FnZXMuYWRkaXRpb25hbC5sZW5ndGggPT09IDAgfHwgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BsYXVzaWJsZS1hbmFseXRpY3Mtd2l6YXJkJykgIT09IG51bGwpIHtcblx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAobWVzc2FnZXMuYWRkaXRpb25hbC5pZCAhPT0gdW5kZWZpbmVkICYmIG1lc3NhZ2VzLmFkZGl0aW9uYWwubWVzc2FnZSkge1xuXHRcdFx0XHRcdHBsYXVzaWJsZS5zaG93QWRkaXRpb25hbE1lc3NhZ2UobWVzc2FnZXMuYWRkaXRpb25hbC5tZXNzYWdlLCBtZXNzYWdlcy5hZGRpdGlvbmFsLmlkKTtcblx0XHRcdFx0fSBlbHNlIGlmIChtZXNzYWdlcy5hZGRpdGlvbmFsLmlkICE9PSB1bmRlZmluZWQgJiYgbWVzc2FnZXMuYWRkaXRpb25hbC5tZXNzYWdlID09PSAnJykge1xuXHRcdFx0XHRcdHBsYXVzaWJsZS5yZW1vdmVBZGRpdGlvbmFsTWVzc2FnZShtZXNzYWdlcy5hZGRpdGlvbmFsLmlkKTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIEZldGNoIHRoZSBtZXNzYWdlcyBmb3IgZGlzcGxheS5cblx0XHQgKi9cblx0XHRmZXRjaE1lc3NhZ2VzOiBmdW5jdGlvbiAoKSB7XG5cdFx0XHRsZXQgZGF0YSA9IG5ldyBGb3JtRGF0YSgpO1xuXHRcdFx0ZGF0YS5hcHBlbmQoJ2FjdGlvbicsICdwbGF1c2libGVfYW5hbHl0aWNzX21lc3NhZ2VzJyk7XG5cblx0XHRcdGxldCByZXN1bHQgPSBwbGF1c2libGUuYWpheChkYXRhLCBudWxsLCBmYWxzZSk7XG5cblx0XHRcdHJldHVybiByZXN1bHQudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcblx0XHRcdFx0cmV0dXJuIHJlc3BvbnNlO1xuXHRcdFx0fSk7XG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIERpc3BsYXlzIGEgbm90aWNlIG9yIGVycm9yIG1lc3NhZ2UuXG5cdFx0ICpcblx0XHQgKiBAcGFyYW0gbWVzc2FnZVxuXHRcdCAqIEBwYXJhbSB0eXBlIGVycm9yfHdhcm5pbmd8c3VjY2VzcyBEZWZhdWx0cyB0byBzdWNjZXNzLlxuXHRcdCAqL1xuXHRcdHNob3dNZXNzYWdlOiBmdW5jdGlvbiAobWVzc2FnZSwgdHlwZSA9ICdzdWNjZXNzJykge1xuXHRcdFx0aWYgKHR5cGUgPT09ICdlcnJvcicpIHtcblx0XHRcdFx0ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ljb24tZXJyb3InKS5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKTtcblx0XHRcdFx0ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ljb24tc3VjY2VzcycpLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpO1xuXHRcdFx0XHRkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaWNvbi1ub3RpY2UnKS5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZSA9PT0gJ25vdGljZScpIHtcblx0XHRcdFx0ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ljb24tbm90aWNlJykuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7XG5cdFx0XHRcdGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpY29uLWVycm9yJykuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7XG5cdFx0XHRcdGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpY29uLXN1Y2Nlc3MnKS5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpY29uLXN1Y2Nlc3MnKS5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKTtcblx0XHRcdFx0ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ljb24tZXJyb3InKS5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTtcblx0XHRcdFx0ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ljb24tbm90aWNlJykuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7XG5cdFx0XHR9XG5cblx0XHRcdGxldCBub3RpY2UgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGxhdXNpYmxlLWFuYWx5dGljcy1ub3RpY2UnKTtcblxuXHRcdFx0ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BsYXVzaWJsZS1hbmFseXRpY3Mtbm90aWNlLXRleHQnKS5pbm5lckhUTUwgPSBtZXNzYWdlO1xuXG5cdFx0XHRub3RpY2UuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7XG5cblx0XHRcdHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuXHRcdFx0XHRub3RpY2UuY2xhc3NMaXN0LnJlcGxhY2UoJ29wYWNpdHktMCcsICdvcGFjaXR5LTEwMCcpO1xuXHRcdFx0fSwgMjAwKVxuXG5cdFx0XHRpZiAodHlwZSAhPT0gJ2Vycm9yJykge1xuXHRcdFx0XHRzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcblx0XHRcdFx0XHRub3RpY2UuY2xhc3NMaXN0LnJlcGxhY2UoJ29wYWNpdHktMTAwJywgJ29wYWNpdHktMCcpO1xuXHRcdFx0XHRcdHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuXHRcdFx0XHRcdFx0bm90aWNlLmNsYXNzTGlzdCArPSAnIGhpZGRlbic7XG5cdFx0XHRcdFx0fSwgMjAwKVxuXHRcdFx0XHR9LCAyMDAwKTtcblx0XHRcdH1cblx0XHR9LFxuXHRcdC8qKlxuXHRcdCAqIFJlbmRlcnMgYSBIVE1MIGJveCBjb250YWluaW5nIGFkZGl0aW9uYWwgaW5mb3JtYXRpb24gYWJvdXQgdGhlIGVuYWJsZWQgb3B0aW9uLlxuXHRcdCAqXG5cdFx0ICogQHBhcmFtIGh0bWxcblx0XHQgKiBAcGFyYW0gdGFyZ2V0XG5cdFx0ICovXG5cdFx0c2hvd0FkZGl0aW9uYWxNZXNzYWdlOiBmdW5jdGlvbiAoaHRtbCwgdGFyZ2V0KSB7XG5cdFx0XHRsZXQgdGFyZ2V0RWxlbSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYFtuYW1lPScke3RhcmdldH0nXWApO1xuXHRcdFx0bGV0IGNvbnRhaW5lciA9IHRhcmdldEVsZW0uY2xvc2VzdCgnLnBsYXVzaWJsZS1hbmFseXRpY3MtZ3JvdXAnKTtcblxuXHRcdFx0aWYgKGNvbnRhaW5lci5jaGlsZHJlbi5sZW5ndGggPiAwKSB7XG5cdFx0XHRcdGZvciAobGV0IGkgPSAwOyBpIDwgY29udGFpbmVyLmNoaWxkcmVuLmxlbmd0aDsgaSsrKSB7XG5cdFx0XHRcdFx0aWYgKGNvbnRhaW5lci5jaGlsZHJlbltpXS5pZC5pbmNsdWRlcyh0YXJnZXQpKSB7XG5cdFx0XHRcdFx0XHQvLyBUaGlzIG1lc3NhZ2UgYWxyZWFkeSBleGlzdHMuXG5cdFx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGNvbnRhaW5lci5pbm5lckhUTUwgKz0gaHRtbDtcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogUmVtb3ZlcyB0aGUgYWRkaXRpb25hbCBpbmZvcm1hdGlvbiBib3ggd2hlbiB0aGUgb3B0aW9uIGlzIGRpc2FibGVkLlxuXHRcdCAqXG5cdFx0ICogQHBhcmFtIHRhcmdldFxuXHRcdCAqL1xuXHRcdHJlbW92ZUFkZGl0aW9uYWxNZXNzYWdlOiBmdW5jdGlvbiAodGFyZ2V0KSB7XG5cdFx0XHRsZXQgdGFyZ2V0RWxlbSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYFtuYW1lPVwiJHt0YXJnZXR9XCJdYCk7XG5cdFx0XHRsZXQgY29udGFpbmVyID0gdGFyZ2V0RWxlbS5jbG9zZXN0KCcucGxhdXNpYmxlLWFuYWx5dGljcy1ncm91cCcpO1xuXHRcdFx0bGV0IGFkZGl0aW9uYWxNZXNzYWdlO1xuXG5cdFx0XHRpZiAoY29udGFpbmVyLmNoaWxkcmVuLmxlbmd0aCA+IDApIHtcblx0XHRcdFx0Zm9yIChsZXQgaSA9IDA7IGkgPCBjb250YWluZXIuY2hpbGRyZW4ubGVuZ3RoOyBpKyspIHtcblx0XHRcdFx0XHRpZiAoY29udGFpbmVyLmNoaWxkcmVuW2ldLmNsYXNzTGlzdC5jb250YWlucygncGxhdXNpYmxlLWFuYWx5dGljcy1ob29rJykpIHtcblx0XHRcdFx0XHRcdGFkZGl0aW9uYWxNZXNzYWdlID0gY29udGFpbmVyLmNoaWxkcmVuW2ldO1xuXG5cdFx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKGFkZGl0aW9uYWxNZXNzYWdlICE9PSB1bmRlZmluZWQgJiYgIWFkZGl0aW9uYWxNZXNzYWdlLmNsYXNzTGlzdC5jb250YWlucygncGxhdXNpYmxlLWFuYWx5dGljcy1wZXJzaXN0JykpIHtcblx0XHRcdFx0Y29udGFpbmVyLnJlbW92ZUNoaWxkKGFkZGl0aW9uYWxNZXNzYWdlKTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRwbGF1c2libGUuaW5pdCgpO1xufSk7XG4iXSwibmFtZXMiOlsiZG9jdW1lbnQiLCJhZGRFdmVudExpc3RlbmVyIiwibG9jYXRpb24iLCJocmVmIiwiaW5jbHVkZXMiLCJwbGF1c2libGUiLCJub25jZUVsZW0iLCJnZXRFbGVtZW50QnlJZCIsIm5vbmNlIiwic2hvd1dpemFyZEVsZW0iLCJkb21haW5OYW1lRWxlbSIsImFwaVRva2VuRWxlbSIsImNyZWF0ZUFQSVRva2VuRWxlbXMiLCJnZXRFbGVtZW50c0J5Q2xhc3NOYW1lIiwiYnV0dG9uRWxlbXMiLCJzdGVwRWxlbXMiLCJpbml0IiwiaGFzaCIsInRoaXMiLCJ2YWx1ZSIsInRvZ2dsZVdpemFyZFN0ZXAiLCJ3aW5kb3ciLCJzaG93V2l6YXJkIiwiZGlzYWJsZUNvbm5lY3RCdXR0b24iLCJsZW5ndGgiLCJpIiwiY3JlYXRlQVBJVG9rZW4iLCJzYXZlT3B0aW9uIiwidG9nZ2xlT3B0aW9uIiwic2F2ZU9wdGlvbk9uTmV4dCIsInNob3dNZXNzYWdlcyIsImUiLCJ0YXJnZXQiLCJjbGFzc0xpc3QiLCJjb250YWlucyIsImJ1dHRvbiIsImNsb3Nlc3QiLCJ0b2dnbGUiLCJ0b2dnbGVTdGF0dXMiLCJ0eXBlIiwicXVlcnlTZWxlY3RvciIsInJlcGxhY2UiLCJmb3JtIiwiRm9ybURhdGEiLCJhcHBlbmQiLCJuYW1lIiwibmV4dEVsZW1lbnRTaWJsaW5nIiwiaW5uZXJIVE1MIiwiZGF0YXNldCIsImxpc3QiLCJhamF4IiwiaW5wdXRzIiwicXVlcnlTZWxlY3RvckFsbCIsIm9wdGlvbnMiLCJmb3JFYWNoIiwiaW5wdXQiLCJ2YWxpZGF0ZUlucHV0IiwicHVzaCIsIkpTT04iLCJzdHJpbmdpZnkiLCJjaGlsZHJlbiIsInJlbW92ZSIsInNldEF0dHJpYnV0ZSIsIm1hdGNoIiwiZ2V0RWxlbWVudHNCeVRhZ05hbWUiLCJkYXRhIiwidGhlbiIsInJlc3BvbnNlIiwic3VjY2VzcyIsInJlbW92ZUF0dHJpYnV0ZSIsImJ1dHRvbklzSHJlZiIsInNsaWRlX2lkIiwiZGlzYWJsZWQiLCJwcmV2ZW50RGVmYXVsdCIsImRvbWFpbiIsInJlcGxhY2VBbGwiLCJvcGVuIiwicGxhdXNpYmxlX2FuYWx5dGljc19ob3N0ZWRfZG9tYWluIiwic3Vic3RyaW5nIiwiYWxsU3RlcHMiLCJhY3RpdmVTdGVwcyIsImNvbXBsZXRlZFN0ZXBzIiwiY3VycmVudFN0ZXAiLCJpbmFjdGl2ZUN1cnJlbnRTdGVwIiwiY3VycmVudGx5Q29tcGxldGVkU3RlcHMiLCJzcGxpdCIsImZpbHRlciIsIm4iLCJzdGVwIiwiY29tcGxldGVkU3RlcCIsImluYWN0aXZlU3RlcCIsImZldGNoIiwiYWpheHVybCIsIm1ldGhvZCIsImJvZHkiLCJpZCIsInN0YXR1cyIsImlubmVyVGV4dCIsInBsYXVzaWJsZV9hbmFseXRpY3NfaTE4biIsImNvbm5lY3RlZCIsImpzb24iLCJldmVudCIsIkN1c3RvbUV2ZW50IiwiZGV0YWlsIiwiZGlzcGF0Y2hFdmVudCIsInVuZGVmaW5lZCIsImZldGNoTWVzc2FnZXMiLCJtZXNzYWdlcyIsImVycm9yIiwic2hvd01lc3NhZ2UiLCJub3RpY2UiLCJhZGRpdGlvbmFsIiwibWVzc2FnZSIsInNob3dBZGRpdGlvbmFsTWVzc2FnZSIsInJlbW92ZUFkZGl0aW9uYWxNZXNzYWdlIiwiYWRkIiwic2V0VGltZW91dCIsImh0bWwiLCJjb250YWluZXIiLCJhZGRpdGlvbmFsTWVzc2FnZSIsInJlbW92ZUNoaWxkIl0sInNvdXJjZVJvb3QiOiIifQ==